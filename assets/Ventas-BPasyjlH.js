import{u as Q}from"./useVentas-Dh-y8qJc.js";import{_ as W}from"./NotaVentaPDF-JeoQfaAu.js";import{a as X}from"./ventasService-DCVRaxEV.js";import{g as Y}from"./clientesService-BdJJ_DmW.js";import{_ as Z,r as v,c as d,a as n,b as l,u as e,w as u,t as c,ai as P,n as aa,e as o,A as w,q as A,s as r,i as g,f as $,h,K as D,L as x,j as ea,k as ta}from"./index-DKaPuLj0.js";import"./_commonjsHelpers-Cpj98o6Y.js";const la={class:"ventas-container"},ia={class:"ventas-card"},na={class:"ventas-form-header"},da={class:"ventas-form-col"},oa={class:"ventas-form-col"},sa={key:0},ua={key:1},ca={key:0,class:"error-text"},ra={class:"imei-cell"},ma={key:0},va={key:0},ba={class:"imei-value"},_a={class:"mb-2"},pa={class:"mb-2 acciones-footer"},fa={__name:"Ventas",setup(Va){const{today:F,clientes:L,articulosDisponibles:N,ventas:ga,ventaSeleccionada:ha,detalleVenta:ya,imeis:ka,showDialog:_,venta:s,guardarVenta:M,cargarDetalleVenta:Ca,articulosConStock:y,addArticulo:E,getStockDisponible:p,mostrarColumnaIMEI:G,onArticuloChange:R,removeArticulo:B,validateCantidad:T,totalVenta:j,imeisDisponiblesPorArticulo:q,getVentas:K}=Q(),k=v(!1),O=v([]),I=v({}),S=v([]);async function z(){C.value=!0;try{await M();const m=await K(),t=m[m.length-1],a=await X(t.id);O.value=a;const i=await Y();I.value=i.find(V=>V.id===t.cliente_id)||{};const b=await aa();S.value=a.map(V=>{const U=b.find(J=>J.id===V.articulo_id)||{};return{...V,sku:U.sku,nombre:U.nombre}}),k.value=!0}finally{C.value=!1}}v(!1);const C=v(!1);function H(){_.value=!1,k.value=!1}const f=m=>{const t=N.value.find(a=>a.id===m);return t&&t.tipo&&t.tipo.toLowerCase()==="servicio"};return(m,t)=>(o(),d("div",la,[t[9]||(t[9]=n("h2",{class:"ventas-title"},"Registrar Nota de Venta",-1)),n("div",ia,[n("div",na,[n("div",da,[t[4]||(t[4]=n("label",{class:"mb-2"},"Cliente",-1)),l(e(w),{modelValue:e(s).cliente_id,"onUpdate:modelValue":t[0]||(t[0]=a=>e(s).cliente_id=a),options:e(L),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full"},null,8,["modelValue","options"])]),n("div",oa,[t[5]||(t[5]=n("label",null,"Fecha",-1)),l(e(A),{modelValue:e(s).fecha,"onUpdate:modelValue":t[1]||(t[1]=a=>e(s).fecha=a),value:e(F),readonly:"",class:"fecha-input"},null,8,["modelValue","value"])])]),t[8]||(t[8]=n("h3",null,"Artículos",-1)),l(e(ea),{value:e(s).articulos,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[l(e(r),{header:"Artículo"},{body:u(a=>[l(e(w),{modelValue:a.data.articulo_id,"onUpdate:modelValue":i=>a.data.articulo_id=i,options:e(y)(a.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:i=>e(R)(a.data.articulo_id,a.data),disabled:e(y)(a.data).length===0},null,8,["modelValue","onUpdate:modelValue","options","onChange","disabled"])]),_:1}),l(e(r),{header:"Stock"},{body:u(a=>[f(a.data.articulo_id)?(o(),d("span",sa,"NA")):(o(),d("span",ua,c(e(p)(a.data.articulo_id,a.data)),1))]),_:1}),l(e(r),{field:"cantidad",header:"Cantidad"},{body:u(a=>[l(e(A),{type:"number",modelValue:a.data.cantidad,"onUpdate:modelValue":i=>a.data.cantidad=i,modelModifiers:{number:!0},min:1,max:f(a.data.articulo_id)?null:e(p)(a.data.articulo_id,a.data),class:"w-full",disabled:!a.data.articulo_id,onInput:i=>e(T)(a.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"]),!f(a.data.articulo_id)&&a.data.cantidad>e(p)(a.data.articulo_id,a.data)?(o(),d("small",ca," Máx: "+c(e(p)(a.data.articulo_id,a.data)),1)):g("",!0)]),_:1}),l(e(r),{field:"precio_unitario",header:"Precio"},{body:u(a=>[n("span",null,c((a.data.precio_unitario??0).toFixed(2)),1)]),_:1}),l(e(r),{field:"subtotal",header:"Subtotal"},{body:u(a=>[$(c(((a.data.cantidad??0)*(a.data.precio_unitario??0)).toFixed(2)),1)]),_:1}),l(e(r),{header:"Acciones"},{body:u(a=>[l(e(h),{icon:"pi pi-trash",class:"p-button-danger p-button-sm",onClick:i=>e(B)(a.index)},null,8,["onClick"])]),_:1}),l(e(r),{header:"IMEI"},{body:u(a=>[n("div",ra,[f(a.data.articulo_id)?(o(),d("span",ma,"NA")):e(G)(a.data.articulo_id)?(o(),d(D,{key:1},[(o(!0),d(D,null,x(a.data.cantidad,i=>(o(),d("div",{key:i,style:{"margin-bottom":"0.2em"}},[l(e(w),{modelValue:a.data.imeis[i-1],"onUpdate:modelValue":b=>a.data.imeis[i-1]=b,options:e(q)(a.data.articulo_id,a.data,i-1),optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full imei-dropdown",disabled:!a.data.articulo_id,filter:""},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]))),128)),a.data.imeis&&a.data.imeis.length?(o(),d("div",va,[m.imei?(o(!0),d(D,{key:0},x(a.data.imeis,(i,b)=>(o(),d("span",{key:i,class:"imei-seleccionado"},[$(" IMEI "+c(b+1)+": ",1),n("span",ba,c(i),1)]))),128)):g("",!0)])):g("",!0)],64)):g("",!0)])]),_:1})]),_:1},8,["value"]),l(e(h),{label:"Agregar Artículo",icon:"pi pi-plus",class:"mb-2",onClick:e(E),disabled:e(y)().length===0},null,8,["onClick","disabled"]),n("div",_a,[t[6]||(t[6]=n("label",null,"Observaciones",-1)),l(e(A),{modelValue:e(s).observaciones,"onUpdate:modelValue":t[2]||(t[2]=a=>e(s).observaciones=a),class:"w-full"},null,8,["modelValue"])]),n("div",pa,[n("strong",null,"Total: $"+c((e(j)??0).toFixed(2)),1),l(e(h),{label:"Guardar Venta",class:"mb-2",onClick:z,disabled:!e(s).cliente_id||e(s).articulos.length===0||C.value},null,8,["disabled"])]),l(e(ta),{visible:e(_),"onUpdate:visible":t[3]||(t[3]=a=>P(_)?_.value=a:null),header:"Venta registrada",closable:!1,modal:!0,class:"ventas-dialog"},{default:u(()=>[t[7]||(t[7]=n("p",null,"La nota de venta se registró correctamente.",-1)),l(W,{venta:e(s),cliente:I.value,articulos:S.value,empresa:{nombre:"GPSubicacion.com",direccion:"Guadalajara",rfc:"RFC123456"},"venta-registrada":k.value},null,8,["venta","cliente","articulos","venta-registrada"]),l(e(h),{label:"Aceptar",icon:"pi pi-check",onClick:H,autofocus:""})]),_:1},8,["visible"])])]))}},$a=Z(fa,[["__scopeId","data-v-08b9c26c"]]);export{$a as default};
