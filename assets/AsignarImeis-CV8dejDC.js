import{_ as V,r as i,k as $,c as m,a,n as y,b as o,d as n,v as x,x as C,F as N,y as B,q as D,w as M,m as U,z as j,o as g,p as K,g as L,A as S,t as f,i as I,j as _}from"./index-KkKpnkLs.js";import{g as q}from"./articulosService-DbWksm40.js";const z={class:"asignar-imeis-container"},F={class:"form-card"},O={class:"form-group"},R={class:"form-group"},Y={key:0,class:"imeis-list"},P={class:"form-actions"},T={class:"dialog-actions"},W={style:{"white-space":"pre-line"}},G={class:"dialog-actions"},H={__name:"AsignarImeis",setup(J){const b=i([]),r=i(null),c=i(""),l=i([]),d=i(""),u=i(!1),p=i(!1),E=i(""),v=i([]);$(async()=>{b.value=await q()});const h=()=>{const t=c.value.trim();if(t){if(l.value.includes(t)){E.value=`El IMEI "${t}" ya está en la lista.`,p.value=!0,c.value="";return}l.value.push(t),c.value=""}},A=t=>{l.value.splice(t,1)},k=async()=>{if(!(!r.value||l.value.length===0)){try{const t=await U(),e=new Set(t.map(s=>s.imei));v.value=l.value.filter(s=>e.has(s))}catch{d.value="Error al validar IMEIs existentes en la base de datos.",u.value=!0;return}if(v.value.length>0){d.value=`Los siguientes IMEIs ya están registrados en el sistema:
${v.value.join(`
`)}
Elimínalos de la lista para continuar.`,u.value=!0;return}try{await j(r.value.nombre,l.value),d.value=`${l.value.length} IMEIs asignados al artículo "${r.value.nombre}" correctamente.`,l.value=[],v.value=[]}catch{d.value="Ocurrió un error al asignar los IMEIs."}u.value=!0}};return(t,e)=>(g(),m("div",z,[e[8]||(e[8]=a("h2",null,"Asignar IMEIs a Artículo",-1)),a("div",F,[a("div",O,[e[6]||(e[6]=a("label",{for:"articulo"},[y(" Artículo "),a("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),o(n(K),{id:"articulo",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value=s),options:b.value,optionLabel:"nombre",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),a("div",R,[e[7]||(e[7]=a("label",{for:"nuevoImei"},"IMEI:",-1)),o(n(L),{id:"nuevoImei",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=s=>c.value=s),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!r.value,onKeydown:x(C(h,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),l.value.length?(g(),m("ul",Y,[(g(!0),m(N,null,B(l.value,(s,w)=>(g(),m("li",{key:w,class:S({"imei-existente":v.value.includes(s)})},[y(f(s)+" ",1),o(n(I),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:Q=>A(w)},null,8,["onClick"])],2))),128))])):D("",!0)]),a("div",P,[o(n(I),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:k,class:"p-button-success",disabled:l.value.length===0},null,8,["disabled"])])]),o(n(_),{visible:u.value,"onUpdate:visible":e[3]||(e[3]=s=>u.value=s),header:"Resultado",modal:!0,closable:!1},{default:M(()=>[a("p",null,f(d.value),1),a("div",T,[o(n(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[2]||(e[2]=s=>u.value=!1),autofocus:""})])]),_:1},8,["visible"]),o(n(_),{visible:p.value,"onUpdate:visible":e[5]||(e[5]=s=>p.value=s),header:"Advertencia",modal:!0,closable:!1},{default:M(()=>[a("p",W,f(E.value),1),a("div",G,[o(n(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[4]||(e[4]=s=>p.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},ee=V(H,[["__scopeId","data-v-60c6c018"]]);export{ee as default};
