import{_ as T,r as o,l as A,k as j,m as F,A as K,c as I,a as l,p as M,b as u,d as r,B as q,C as R,F as Y,D as z,v as x,E as G,G as H,w as C,n as U,H as D,I as J,o as E,q as V,g as P,J as W,t as k,i as y,j as _}from"./index-ZunxwIPK.js";const Q={class:"asignar-imeis-container"},X={class:"form-card"},Z={class:"form-group"},ee={class:"form-group"},ae={key:0,class:"imeis-list"},le={class:"form-group"},se={class:"form-group"},ie={key:0,class:"form-group"},oe={class:"form-actions"},ne={class:"dialog-actions"},te={style:{"white-space":"pre-line"}},ue={class:"dialog-actions"},re={__name:"AsignarImeis",setup(ce){const h=o([]),m=o(null),f=o(""),s=o([]),v=o(""),d=o(!1),p=o(!1),w=o(""),b=o([]),g=o([]),n=o(null),c=o(!1),t=o(null),O=A(()=>h.value.filter(i=>i.tipo&&i.tipo.toLowerCase()!=="servicio")),L=A(()=>!c.value||!t.value?g.value:g.value.filter(i=>i.id!==t.value.id));j(async()=>{h.value=await F(),g.value=await K(),n.value=g.value[0]||null,t.value=g.value[0]||null});const B=()=>{const i=f.value.trim();if(i){if(s.value.includes(i)){w.value=`El IMEI "${i}" ya está en la lista.`,p.value=!0,f.value="";return}s.value.push(i),f.value=""}},N=i=>{s.value.splice(i,1)},S=async()=>{if(!(!m.value||s.value.length===0||!n.value)){if(c.value&&t.value&&n.value&&t.value.id===n.value.id){w.value="La ubicación origen y destino no pueden ser la misma.",p.value=!0;return}try{const i=await U(),e=new Set(i.map(a=>a.imei));b.value=s.value.filter(a=>e.has(a))}catch{v.value="Error al validar IMEIs existentes en la base de datos.",d.value=!0;return}if(c.value){if((await U()).filter(a=>s.value.includes(a.imei)&&a.ubicacion_id===t.value.id).length!==s.value.length){w.value="Todos los IMEIs deben existir y estar en la ubicación origen para transferir.",p.value=!0;return}try{await D(n.value.id,s.value,t.value.id),v.value=`${s.value.length} IMEIs transferidos de "${t.value.nombre}" a "${n.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{v.value="Ocurrió un error al transferir los IMEIs."}d.value=!0;return}if(b.value.length>0){v.value=`Los siguientes IMEIs ya están registrados en el sistema:
${b.value.join(`
`)}
Elimínalos de la lista para continuar.`,d.value=!0;return}try{await J(m.value.nombre,s.value),await D(n.value.id,s.value),v.value=`${s.value.length} IMEIs asignados al artículo "${m.value.nombre}" y a la ubicación "${n.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{v.value="Ocurrió un error al asignar los IMEIs."}d.value=!0}};return(i,e)=>(E(),I("div",Q,[e[14]||(e[14]=l("h2",null,"Asignar IMEIs a Artículo",-1)),l("div",X,[l("div",Z,[e[9]||(e[9]=l("label",{for:"articulo"},[M(" Artículo "),l("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),u(r(V),{id:"articulo",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),options:O.value,optionLabel:"nombre",placeholder:"Selecciona artículo",class:"w-full",disabled:c.value},null,8,["modelValue","options","disabled"])]),l("div",ee,[e[10]||(e[10]=l("label",{for:"nuevoImei"},"IMEI:",-1)),u(r(P),{id:"nuevoImei",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!m.value,onKeydown:q(R(B,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),s.value.length?(E(),I("ul",ae,[(E(!0),I(Y,null,z(s.value,(a,$)=>(E(),I("li",{key:$,class:W({"imei-existente":b.value.includes(a)})},[M(k(a)+" ",1),u(r(y),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:ve=>N($)},null,8,["onClick"])],2))),128))])):x("",!0)]),l("div",le,[e[11]||(e[11]=l("label",{for:"ubicacionDestino"}," Ubicación destino ",-1)),u(r(V),{disabled:!c.value,id:"ubicacionDestino",modelValue:n.value,"onUpdate:modelValue":e[2]||(e[2]=a=>n.value=a),options:L.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["disabled","modelValue","options"])]),l("div",se,[l("label",null,[G(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a)},null,512),[[H,c.value]]),e[12]||(e[12]=M(" Transferencia entre ubicaciones "))])]),c.value?(E(),I("div",ie,[e[13]||(e[13]=l("label",{for:"ubicacionOrigen"},"Ubicación origen",-1)),u(r(V),{id:"ubicacionOrigen",modelValue:t.value,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value=a),options:g.value,optionLabel:"nombre",placeholder:"Selecciona ubicación origen",class:"w-full"},null,8,["modelValue","options"])])):x("",!0),l("div",oe,[u(r(y),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:S,class:"p-button-success",disabled:s.value.length===0},null,8,["disabled"])])]),u(r(_),{visible:d.value,"onUpdate:visible":e[6]||(e[6]=a=>d.value=a),header:"Resultado",modal:!0,closable:!1},{default:C(()=>[l("p",null,k(v.value),1),l("div",ne,[u(r(y),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>d.value=!1),autofocus:""})])]),_:1},8,["visible"]),u(r(_),{visible:p.value,"onUpdate:visible":e[8]||(e[8]=a=>p.value=a),header:"Advertencia",modal:!0,closable:!1},{default:C(()=>[l("p",te,k(w.value),1),l("div",ue,[u(r(y),{label:"Aceptar",icon:"pi pi-check",onClick:e[7]||(e[7]=a=>p.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},me=T(re,[["__scopeId","data-v-ac9e3a1b"]]);export{me as default};
