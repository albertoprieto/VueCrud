import{g as J,u as Q,a as R,d as W}from"./articulosService-Cnuihfk0.js";import{_ as Y,r,k as Z,l as ee,c as x,a as l,b as a,d as s,w as c,m as oe,o as C,i as u,g as V,s as p,n as E,t as g,e as le,p as U,q as D,j as N}from"./index-DrPL23k6.js";import{u as h,w as ae,F as se}from"./FileSaver.min-Bul9EBtc.js";const te={class:"articulos"},ie={class:"actions"},re={class:"articulos-card"},ne={class:"modal-content"},ue={class:"modal-title"},de={class:"form-grid"},ce={class:"form-col"},pe={class:"form-group"},me={class:"form-group"},ve={key:0,class:"error-text"},be={class:"form-group"},fe={key:0,class:"error-text"},Ve={class:"form-group"},ge={class:"form-col"},ke={class:"form-group"},we={class:"form-group"},Ae={class:"form-group"},ye={class:"modal-actions"},_e={class:"dialog-content"},xe={class:"modal-actions"},Ce={class:"dialog-content"},Ee={class:"modal-actions"},Ue={__name:"Articulos",setup(Ne){const k=r([]),A=r([]),y=r(!0),m=r(!1),t=r({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""}),v=r(""),B=r("nombre"),F=r(1),b=r(!1),w=r(""),f=r(!1),M=r(null),_=async()=>{y.value=!0;try{k.value=await J(),A.value=await oe()}finally{y.value=!1}};Z(_);const S=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(i)||0),$=i=>{const e=i.nombre;return console.log(i),A.value.filter(n=>n.articulo_nombre===e).length},L=ee(()=>v.value?k.value.filter(i=>{var e,o,n;return((e=i.nombre)==null?void 0:e.toLowerCase().includes(v.value.toLowerCase()))||((o=i.sku)==null?void 0:o.toLowerCase().includes(v.value.toLowerCase()))||((n=i.descripcion)==null?void 0:n.toLowerCase().includes(v.value.toLowerCase()))}):k.value),O=()=>{t.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},m.value=!0},X=()=>{m.value=!1},K=async()=>{if(!t.value.nombre||!t.value.sku){w.value="Por favor, complete los campos obligatorios.",b.value=!0;return}try{const i={...t.value,codigo:t.value.codigo??"",pagina:t.value.pagina??""};t.value.id?await Q(i):await R(i),m.value=!1,await _()}catch{w.value="Error al guardar el artículo.",b.value=!0}},P=i=>{t.value={...i},m.value=!0},j=i=>{M.value=i,f.value=!0},q=async i=>{try{await W(i),await _(),f.value=!1}catch{w.value="Error al eliminar el artículo.",b.value=!0}},z=()=>{const i=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),e=k.value.map(d=>{const I=A.value.filter(H=>H.articulo_nombre===d.nombre).length,T=Number(d.precioVenta)||0;return{Artículo:d.nombre,SKU:d.sku,Tipo:d.tipo,Unidad:d.unidad,"Precio de venta":i.format(T),"Existencias en mano":I,"Total inventario":i.format(T*I),Descripción:d.descripcion,Impuesto:d.impuesto}}),o=h.json_to_sheet(e),n=h.book_new();h.book_append_sheet(n,o,"Artículos");const G=ae(n,{bookType:"xlsx",type:"array"});se.saveAs(new Blob([G],{type:"application/octet-stream"}),"articulos.xlsx")};return(i,e)=>(C(),x("div",te,[e[22]||(e[22]=l("h2",null,"Artículos",-1)),l("div",ie,[a(s(u),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:O}),a(s(u),{label:"Exportar Excel",icon:"pi pi-file-excel",class:"p-button-success",onClick:z}),a(s(V),{modelValue:v.value,"onUpdate:modelValue":e[0]||(e[0]=o=>v.value=o),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),l("div",re,[a(s(le),{value:L.value,sortField:B.value,sortOrder:F.value,responsiveLayout:"scroll",loading:y.value},{default:c(()=>[a(s(p),{field:"sku",header:"SKU",sortable:""}),a(s(p),{field:"nombre",header:"Nombre",sortable:""}),a(s(p),{field:"descripcion",header:"Descripción",sortable:""}),a(s(p),{field:"tipo",header:"Tipo",sortable:""}),a(s(p),{field:"precioVenta",header:"Precio de venta"},{body:c(o=>[E(g(S(o.data.precioVenta)),1)]),_:1}),a(s(p),{header:"Existencias en mano"},{body:c(o=>[E(g($(o.data)),1)]),_:1}),a(s(p),{header:"Total inventario"},{body:c(o=>[E(g(S(o.data.precioVenta*$(o.data))),1)]),_:1}),a(s(p),{header:"Acciones"},{body:c(o=>[a(s(u),{icon:"pi pi-pencil",class:"p-button-text",onClick:n=>P(o.data)},null,8,["onClick"]),a(s(u),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:n=>j(o.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),a(s(N),{visible:m.value,"onUpdate:visible":e[8]||(e[8]=o=>m.value=o),header:t.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:c(()=>[l("div",ne,[l("h3",ue,g(t.value.id?"Editar Artículo":"Nuevo Artículo"),1),l("div",de,[l("div",ce,[l("div",pe,[e[14]||(e[14]=l("label",{for:"tipo"},"Tipo:",-1)),a(s(U),{id:"tipo",modelValue:t.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.tipo=o),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),l("div",me,[e[15]||(e[15]=l("label",{for:"nombre"},"Nombre:",-1)),a(s(V),{id:"nombre",modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.nombre=o),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),t.value.nombre?D("",!0):(C(),x("small",ve,"Obligatorio."))]),l("div",be,[e[16]||(e[16]=l("label",{for:"sku"},"SKU:",-1)),a(s(V),{id:"sku",modelValue:t.value.sku,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.sku=o),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),t.value.sku?D("",!0):(C(),x("small",fe,"Obligatorio."))]),l("div",Ve,[e[17]||(e[17]=l("label",{for:"unidad"},"Unidad:",-1)),a(s(U),{id:"unidad",modelValue:t.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.unidad=o),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])])]),l("div",ge,[l("div",ke,[e[18]||(e[18]=l("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),a(s(V),{id:"precioVenta",modelValue:t.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.precioVenta=o),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])]),l("div",we,[e[19]||(e[19]=l("label",{for:"impuesto"},"Impuesto:",-1)),a(s(U),{id:"impuesto",modelValue:t.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.impuesto=o),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),l("div",Ae,[e[20]||(e[20]=l("label",{for:"descripcion"},"Descripción:",-1)),a(s(V),{id:"descripcion",modelValue:t.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.descripcion=o),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])])])]),l("div",ye,[a(s(u),{label:"Guardar",icon:"pi pi-save",onClick:K}),a(s(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:X})])])]),_:1},8,["visible","header"]),a(s(N),{visible:b.value,"onUpdate:visible":e[10]||(e[10]=o=>b.value=o),header:"Error",modal:!0,closable:!1},{default:c(()=>[l("div",_e,[l("p",null,g(w.value),1),l("div",xe,[a(s(u),{label:"Aceptar",icon:"pi pi-check",onClick:e[9]||(e[9]=o=>b.value=!1)})])])]),_:1},8,["visible"]),a(s(N),{visible:f.value,"onUpdate:visible":e[13]||(e[13]=o=>f.value=o),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:c(()=>[l("div",Ce,[e[21]||(e[21]=l("p",null,"¿Eliminar este artículo?",-1)),l("div",Ee,[a(s(u),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[11]||(e[11]=o=>q(M.value))}),a(s(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[12]||(e[12]=o=>f.value=!1)})])])]),_:1},8,["visible"])]))}},$e=Y(Ue,[["__scopeId","data-v-402ec242"]]);export{$e as default};
