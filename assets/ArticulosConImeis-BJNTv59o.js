import{_ as $,r as a,l as u,k as P,c as H,a as n,b as i,d as r,w as K,n as C,t as X,m as q,o as z,g as G,i as J,s as l,e as Q}from"./index-Dfk-US5Q.js";import{g as R}from"./articulosService-Tx5LGeDP.js";import{g as W}from"./ubicacionesService-B8ot2R83.js";import{u as I,w as Y,F as Z}from"./FileSaver.min-Bul9EBtc.js";const ee={class:"articulos-con-imeis"},oe={class:"table-actions"},te={class:"articulos-imeis-card"},se={class:"resumen-totales"},ae={class:"total-disponible"},ie={class:"total-vendido"},re={__name:"ArticulosConImeis",setup(ne){const v=a([]),x=a([]),V=a([]),w=a(!0);a(!1);const y=a([]),d=a(""),M=a("articulo_nombre"),k=a(1),D=a(!1),S=a(!1),E=u(()=>{const o={};return v.value.forEach(e=>{o[e.articulo_nombre]||(o[e.articulo_nombre]=[]),o[e.articulo_nombre].push(e)}),Object.entries(o).map(([e,s])=>({articulo_nombre:e,cantidad:s.length,imeis:s}))});u(()=>d.value?E.value.filter(o=>{var e;return(e=o.articulo_nombre)==null?void 0:e.toLowerCase().includes(d.value.toLowerCase())}):E.value),u(()=>D.value?y.value.filter(o=>o.status==="Vendido"):S.value?y.value.filter(o=>o.status==="Disponible"):y.value);const m=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),f=u(()=>{const o={};return v.value.forEach(e=>{o[e.articulo_nombre]||(o[e.articulo_nombre]=[]),o[e.articulo_nombre].push(e)}),Object.entries(o).map(([e,s])=>{var F,T;const N=s.length,b=s.filter(c=>c.status==="Disponible").length,_=s.filter(c=>c.status==="Vendido").length,t=x.value.find(c=>c.nombre===e),p=Number(t==null?void 0:t.precioVenta)||0,h=(F=s[0])==null?void 0:F.ubicacion_id,g=((T=V.value.find(c=>c.id===h))==null?void 0:T.nombre)||"";return{articulo_nombre:e,precio_unitario:m.format(p),cantidad_total:N,cantidad_disponible:b,cantidad_vendidos:_,total_disponible:m.format(b*p),total_vendido:m.format(_*p),ubicacion_nombre:g}})}),O=u(()=>d.value?f.value.filter(o=>{var e;return(e=o.articulo_nombre)==null?void 0:e.toLowerCase().includes(d.value.toLowerCase())}):f.value),B=u(()=>m.format(f.value.reduce((o,e)=>o+Number(e.total_disponible.replace(/[^0-9.-]+/g,"")),0))),L=u(()=>m.format(f.value.reduce((o,e)=>o+Number(e.total_vendido.replace(/[^0-9.-]+/g,"")),0))),U=o=>{M.value=o.sortField,k.value=o.sortOrder},j=async()=>{w.value=!0;try{const o=await q(),e=await fetch("https://64.227.15.111/imeis-vendidos").then(s=>s.json());v.value=[...o,...e],x.value=await R(),V.value=await W()}finally{w.value=!1}},A=()=>{const o={};v.value.forEach(t=>{o[t.articulo_nombre]||(o[t.articulo_nombre]=[]),o[t.articulo_nombre].push(t)});const e=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),s=x.value.map(t=>{var g;const p=((g=o[t.nombre])==null?void 0:g.length)||0,h=Number(t.precioVenta)||0;return{Artículo:t.nombre,SKU:t.sku,Tipo:t.tipo,Unidad:t.unidad,"Precio unitario":e.format(h),"Cantidad en stock":p,"Total inventario":e.format(h*p),Descripción:t.descripcion,Impuesto:t.impuesto}}),N=I.json_to_sheet(s),b=I.book_new();I.book_append_sheet(b,N,"Inventario");const _=Y(b,{bookType:"xlsx",type:"array"});Z.saveAs(new Blob([_],{type:"application/octet-stream"}),"inventario.xlsx")};return P(j),(o,e)=>(z(),H("div",ee,[e[3]||(e[3]=n("h2",null,"Historico",-1)),n("div",oe,[i(r(G),{modelValue:d.value,"onUpdate:modelValue":e[0]||(e[0]=s=>d.value=s),placeholder:"Filtrar por artículo...",class:"p-inputtext-sm",style:{"max-width":"250px"}},null,8,["modelValue"]),i(r(J),{icon:"pi pi-file-excel",class:"p-button-success p-button-sm",label:"Exportar Excel",style:{"margin-left":"1rem"},onClick:A})]),n("div",te,[i(r(Q),{value:O.value,sortField:M.value,sortOrder:k.value,responsiveLayout:"scroll",onSort:U,loading:w.value},{default:K(()=>[i(r(l),{field:"articulo_nombre",header:"Artículo",sortable:""}),i(r(l),{field:"precio_unitario",header:"Precio unitario",sortable:""}),i(r(l),{field:"cantidad_total",header:"Total IMEIs",sortable:""}),i(r(l),{field:"cantidad_disponible",header:"Disponibles",sortable:""}),i(r(l),{field:"cantidad_vendidos",header:"Vendidos",sortable:""}),i(r(l),{field:"total_disponible",header:"Total disponibles (MXN)",sortable:""}),i(r(l),{field:"total_vendido",header:"Total vendidos (MXN)",sortable:""}),i(r(l),{field:"ubicacion_nombre",header:"Ubicación",sortable:""})]),_:1},8,["value","sortField","sortOrder","loading"])]),n("div",se,[n("div",ae,[e[1]||(e[1]=C("Total disponibles: ")),n("span",null,X(B.value),1)]),n("div",ie,[e[2]||(e[2]=C("Total vendidos: ")),n("span",null,X(L.value),1)])])]))}},pe=$(re,[["__scopeId","data-v-6d3854f4"]]);export{pe as default};
