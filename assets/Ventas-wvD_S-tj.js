import{u as T}from"./useVentas-CKjoap5V.js";import{_ as q,r as O,c as r,a as t,b as i,d as e,w as n,t as o,C as $,o as u,p as C,g as h,s,n as k,q as b,i as m,D as j,e as S,F as G,y as z,j as w}from"./index-D76T6ImS.js";import"./clientesService-DY7DchyK.js";const H={class:"ventas-container"},J={class:"ventas-card"},K={class:"ventas-form-header"},Q={class:"ventas-form-col"},W={class:"ventas-form-col"},X={key:0,class:"error-text"},Y={key:1,class:"info-text"},Z={class:"imei-cell"},P={key:1,class:"imei-seleccionado"},ee={class:"imei-value"},ae={class:"mb-2"},le={class:"mb-2"},te={key:0,class:"detalle-venta-dialog"},ie={class:"detalle-table"},de={key:0},oe={key:0},ne={class:"detalle-venta-footer"},se={class:"detalle-total"},ue={key:1},re={__name:"Ventas",setup(ce){const{today:A,clientes:D,articulosDisponibles:be,ventas:U,ventaSeleccionada:p,detalleVenta:v,imeis:me,showDialog:_,venta:c,totalVenta:F,articulosConStock:y,getStockDisponible:V,imeisDisponiblesPorArticulo:M,mostrarColumnaIMEI:f,addArticulo:E,removeArticulo:L,validateCantidad:N,onArticuloChange:R,guardarVenta:B,cargarDetalleVenta:x}=T(),g=O(!1);return(ve,l)=>(u(),r("div",H,[l[22]||(l[22]=t("h2",{class:"ventas-title"},"Registrar Nota de Venta",-1)),t("div",J,[t("div",K,[t("div",Q,[l[8]||(l[8]=t("label",{class:"mb-2"},"Cliente",-1)),i(e(C),{modelValue:e(c).cliente_id,"onUpdate:modelValue":l[0]||(l[0]=a=>e(c).cliente_id=a),options:e(D),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full"},null,8,["modelValue","options"])]),t("div",W,[l[9]||(l[9]=t("label",null,"Fecha",-1)),i(e(h),{modelValue:e(c).fecha,"onUpdate:modelValue":l[1]||(l[1]=a=>e(c).fecha=a),value:e(A),readonly:"",class:"fecha-input"},null,8,["modelValue","value"])])]),l[20]||(l[20]=t("h3",null,"Artículos",-1)),i(e(S),{value:e(c).articulos,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:n(()=>[i(e(s),{header:"Artículo"},{body:n(a=>[i(e(C),{modelValue:a.data.articulo_id,"onUpdate:modelValue":d=>a.data.articulo_id=d,options:e(y)(a.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:d=>e(R)(a.data.articulo_id,a.data),disabled:e(y)(a.data).length===0},null,8,["modelValue","onUpdate:modelValue","options","onChange","disabled"])]),_:1}),i(e(s),{header:"Stock"},{body:n(a=>[k(o(e(V)(a.data.articulo_id,a.data)),1)]),_:1}),i(e(s),{field:"cantidad",header:"Cantidad"},{body:n(a=>[i(e(h),{type:"number",modelValue:a.data.cantidad,"onUpdate:modelValue":d=>a.data.cantidad=d,modelModifiers:{number:!0},min:1,max:e(f)(a.data.articulo_id)?1:e(V)(a.data.articulo_id,a.data),class:"w-full",disabled:!a.data.articulo_id||e(f)(a.data.articulo_id),onInput:d=>e(N)(a.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"]),a.data.cantidad>e(V)(a.data.articulo_id,a.data)?(u(),r("small",X," Máx: "+o(e(V)(a.data.articulo_id,a.data)),1)):b("",!0),e(f)(a.data.articulo_id)?(u(),r("small",Y," Solo puedes vender un equipo por fila si requiere IMEI. ")):b("",!0)]),_:1}),i(e(s),{field:"precio_unitario",header:"Precio"},{body:n(a=>[t("span",null,o(a.data.precio_unitario.toFixed(2)),1)]),_:1}),i(e(s),{field:"subtotal",header:"Subtotal"},{body:n(a=>[k(o((a.data.cantidad*a.data.precio_unitario).toFixed(2)),1)]),_:1}),i(e(s),{header:"Acciones"},{body:n(a=>[i(e(m),{icon:"pi pi-trash",class:"p-button-danger p-button-sm",onClick:d=>e(L)(a.index)},null,8,["onClick"])]),_:1}),i(e(s),{header:"IMEI"},{body:n(a=>[t("div",Z,[e(f)(a.data.articulo_id)?(u(),j(e(C),{key:0,modelValue:a.data.imei,"onUpdate:modelValue":d=>a.data.imei=d,options:e(M)(a.data.articulo_id,a.data),optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full imei-dropdown",disabled:!a.data.articulo_id},null,8,["modelValue","onUpdate:modelValue","options","disabled"])):b("",!0),a.data.imei?(u(),r("div",P,[l[10]||(l[10]=t("span",null,"IMEI seleccionado:",-1)),t("span",ee,o(a.data.imei),1)])):b("",!0)])]),_:1})]),_:1},8,["value"]),i(e(m),{label:"Agregar Artículo",icon:"pi pi-plus",class:"mb-2",onClick:e(E),disabled:e(y)().length===0},null,8,["onClick","disabled"]),t("div",ae,[l[11]||(l[11]=t("label",null,"Observaciones",-1)),i(e(h),{modelValue:e(c).observaciones,"onUpdate:modelValue":l[2]||(l[2]=a=>e(c).observaciones=a),class:"w-full"},null,8,["modelValue"])]),t("div",le,[t("strong",null,"Total: $"+o(e(F).toFixed(2)),1)]),i(e(m),{label:"Guardar Venta",class:"mb-2",onClick:e(B),disabled:!e(c).cliente_id||e(c).articulos.length===0},null,8,["onClick","disabled"]),l[21]||(l[21]=t("h2",{class:"ventas-title"},"Ventas Registradas",-1)),i(e(S),{value:e(U),selectionMode:"single",selection:e(p),"onUpdate:selection":l[3]||(l[3]=a=>$(p)?p.value=a:null),onRowSelect:e(x)},{default:n(()=>[i(e(s),{field:"id",header:"ID"}),i(e(s),{field:"cliente_nombre",header:"Cliente"}),i(e(s),{field:"fecha",header:"Fecha"}),i(e(s),{field:"total",header:"Total"}),i(e(s),{header:"Acciones"},{body:n(a=>[i(e(m),{label:"Ver Detalle",icon:"pi pi-eye",class:"p-button-text",onClick:d=>{e(x)({data:a.data}),g.value=!0}},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","onRowSelect"]),i(e(w),{visible:g.value,"onUpdate:visible":l[5]||(l[5]=a=>g.value=a),header:"Detalle de Venta",modal:!0,class:"ventas-dialog"},{default:n(()=>{var a;return[e(v)&&e(v).length?(u(),r("div",te,[t("table",ie,[t("thead",null,[t("tr",null,[l[12]||(l[12]=t("th",null,"Artículo",-1)),l[13]||(l[13]=t("th",null,"Cantidad",-1)),l[14]||(l[14]=t("th",null,"Precio",-1)),l[15]||(l[15]=t("th",null,"Subtotal",-1)),e(v).some(d=>d.imei)?(u(),r("th",de,"IMEI")):b("",!0)])]),t("tbody",null,[(u(!0),r(G,null,z(e(v),d=>(u(),r("tr",{key:d.id},[t("td",null,o(d.articulo_nombre),1),t("td",null,o(d.cantidad),1),t("td",null,"$"+o(d.precio_unitario.toFixed(2)),1),t("td",null,"$"+o((d.cantidad*d.precio_unitario).toFixed(2)),1),d.imei?(u(),r("td",oe,o(d.imei),1)):b("",!0)]))),128))])]),t("div",ne,[t("div",null,[l[16]||(l[16]=t("strong",null,"Observaciones:",-1)),k(" "+o(((a=e(p))==null?void 0:a.observaciones)||"Sin observaciones"),1)]),t("div",se,[l[17]||(l[17]=t("strong",null,"Total:",-1)),k(" $"+o(e(v).reduce((d,I)=>d+I.cantidad*I.precio_unitario,0).toFixed(2)),1)])])])):(u(),r("div",ue,l[18]||(l[18]=[t("span",null,"No hay detalle disponible.",-1)]))),i(e(m),{label:"Cerrar",onClick:l[4]||(l[4]=d=>g.value=!1),class:"detalle-cerrar-btn"})]}),_:1},8,["visible"]),i(e(w),{visible:e(_),"onUpdate:visible":l[7]||(l[7]=a=>$(_)?_.value=a:null),header:"Venta registrada",closable:!1,modal:!0,class:"ventas-dialog"},{default:n(()=>[l[19]||(l[19]=t("p",null,"La nota de venta se registró correctamente.",-1)),i(e(m),{label:"Aceptar",icon:"pi pi-check",onClick:l[6]||(l[6]=a=>_.value=!1),autofocus:""})]),_:1},8,["visible"])])]))}},fe=q(re,[["__scopeId","data-v-7b1e1b7c"]]);export{fe as default};
