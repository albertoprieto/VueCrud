import{g as H,u as Q,a as R,d as W}from"./articulosService-DbWksm40.js";import{_ as Y,r,k as Z,l as ee,c as x,a as l,b as a,d as s,w as c,m as oe,o as C,i as u,g as V,s as p,n as N,t as k,e as le,p as E,q as O,j as U}from"./index-KkKpnkLs.js";import{u as S,w as ae,F as se}from"./FileSaver.min-Bul9EBtc.js";const te={class:"articulos"},ie={class:"actions"},re={class:"articulos-card"},ne={class:"modal-content"},ue={class:"modal-title"},de={class:"form-grid"},ce={class:"form-col"},pe={class:"form-group"},ve={class:"form-group"},me={key:0,class:"error-text"},be={class:"form-group"},fe={key:0,class:"error-text"},ge={class:"form-group"},Ve={class:"form-col"},ke={class:"form-group"},we={class:"form-group"},ye={class:"form-group"},Ae={class:"modal-actions"},_e={class:"dialog-content"},xe={class:"modal-actions"},Ce={class:"dialog-content"},Ne={class:"modal-actions"},Ee={__name:"Articulos",setup(Ue){const f=r([]),w=r([]),A=r(!0),v=r(!1),t=r({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""}),m=r(""),T=r("nombre"),B=r(1),b=r(!1),y=r(""),g=r(!1),M=r(null),_=async()=>{A.value=!0;try{f.value=await H(),w.value=await oe(),console.log("Artículos cargados:",JSON.parse(JSON.stringify(f.value))),console.log("IMEIs cargados:",JSON.parse(JSON.stringify(w.value)))}finally{A.value=!1}};Z(_);const h=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(i)||0),I=i=>{const e=i.nombre;return w.value.filter(n=>n.articulo_nombre===e).length},F=ee(()=>m.value?f.value.filter(i=>{var e,o,n;return((e=i.nombre)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase()))||((o=i.sku)==null?void 0:o.toLowerCase().includes(m.value.toLowerCase()))||((n=i.descripcion)==null?void 0:n.toLowerCase().includes(m.value.toLowerCase()))}):f.value),L=()=>{t.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},v.value=!0},X=()=>{v.value=!1},J=async()=>{if(!t.value.nombre||!t.value.sku){y.value="Por favor, complete los campos obligatorios.",b.value=!0;return}try{const i={...t.value,codigo:t.value.codigo??"",pagina:t.value.pagina??""};t.value.id?await Q(i):await R(i),v.value=!1,await _()}catch{y.value="Error al guardar el artículo.",b.value=!0}},K=i=>{t.value={...i},v.value=!0},P=i=>{M.value=i,g.value=!0},j=async i=>{try{await W(i),await _(),g.value=!1}catch{y.value="Error al eliminar el artículo.",b.value=!0}},q=()=>{const i=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),e=f.value.map(d=>{const $=w.value.filter(G=>G.articulo_nombre===d.nombre).length,D=Number(d.precioVenta)||0;return{Artículo:d.nombre,SKU:d.sku,Tipo:d.tipo,Unidad:d.unidad,"Precio de venta":i.format(D),"Existencias en mano":$,"Total inventario":i.format(D*$),Descripción:d.descripcion,Impuesto:d.impuesto}}),o=S.json_to_sheet(e),n=S.book_new();S.book_append_sheet(n,o,"Artículos");const z=ae(n,{bookType:"xlsx",type:"array"});se.saveAs(new Blob([z],{type:"application/octet-stream"}),"articulos.xlsx")};return(i,e)=>(C(),x("div",te,[e[22]||(e[22]=l("h2",null,"Artículos",-1)),l("div",ie,[a(s(u),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:L}),a(s(u),{label:"Exportar Excel",icon:"pi pi-file-excel",class:"p-button-success",onClick:q}),a(s(V),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),l("div",re,[a(s(le),{value:F.value,sortField:T.value,sortOrder:B.value,responsiveLayout:"scroll",loading:A.value},{default:c(()=>[a(s(p),{field:"sku",header:"SKU",sortable:""}),a(s(p),{field:"nombre",header:"Nombre",sortable:""}),a(s(p),{field:"descripcion",header:"Descripción",sortable:""}),a(s(p),{field:"tipo",header:"Tipo",sortable:""}),a(s(p),{field:"precioVenta",header:"Precio de venta"},{body:c(o=>[N(k(h(o.data.precioVenta)),1)]),_:1}),a(s(p),{header:"Existencias en mano"},{body:c(o=>[N(k(I(o.data)),1)]),_:1}),a(s(p),{header:"Total inventario"},{body:c(o=>[N(k(h(o.data.precioVenta*I(o.data))),1)]),_:1}),a(s(p),{header:"Acciones"},{body:c(o=>[a(s(u),{icon:"pi pi-pencil",class:"p-button-text",onClick:n=>K(o.data)},null,8,["onClick"]),a(s(u),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:n=>P(o.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),a(s(U),{visible:v.value,"onUpdate:visible":e[8]||(e[8]=o=>v.value=o),header:t.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:c(()=>[l("div",ne,[l("h3",ue,k(t.value.id?"Editar Artículo":"Nuevo Artículo"),1),l("div",de,[l("div",ce,[l("div",pe,[e[14]||(e[14]=l("label",{for:"tipo"},"Tipo:",-1)),a(s(E),{id:"tipo",modelValue:t.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.tipo=o),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),l("div",ve,[e[15]||(e[15]=l("label",{for:"nombre"},"Nombre:",-1)),a(s(V),{id:"nombre",modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.nombre=o),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),t.value.nombre?O("",!0):(C(),x("small",me,"Obligatorio."))]),l("div",be,[e[16]||(e[16]=l("label",{for:"sku"},"SKU:",-1)),a(s(V),{id:"sku",modelValue:t.value.sku,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.sku=o),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),t.value.sku?O("",!0):(C(),x("small",fe,"Obligatorio."))]),l("div",ge,[e[17]||(e[17]=l("label",{for:"unidad"},"Unidad:",-1)),a(s(E),{id:"unidad",modelValue:t.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.unidad=o),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])])]),l("div",Ve,[l("div",ke,[e[18]||(e[18]=l("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),a(s(V),{id:"precioVenta",modelValue:t.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.precioVenta=o),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])]),l("div",we,[e[19]||(e[19]=l("label",{for:"impuesto"},"Impuesto:",-1)),a(s(E),{id:"impuesto",modelValue:t.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.impuesto=o),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),l("div",ye,[e[20]||(e[20]=l("label",{for:"descripcion"},"Descripción:",-1)),a(s(V),{id:"descripcion",modelValue:t.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.descripcion=o),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])])])]),l("div",Ae,[a(s(u),{label:"Guardar",icon:"pi pi-save",onClick:J}),a(s(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:X})])])]),_:1},8,["visible","header"]),a(s(U),{visible:b.value,"onUpdate:visible":e[10]||(e[10]=o=>b.value=o),header:"Error",modal:!0,closable:!1},{default:c(()=>[l("div",_e,[l("p",null,k(y.value),1),l("div",xe,[a(s(u),{label:"Aceptar",icon:"pi pi-check",onClick:e[9]||(e[9]=o=>b.value=!1)})])])]),_:1},8,["visible"]),a(s(U),{visible:g.value,"onUpdate:visible":e[13]||(e[13]=o=>g.value=o),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:c(()=>[l("div",Ce,[e[21]||(e[21]=l("p",null,"¿Eliminar este artículo?",-1)),l("div",Ne,[a(s(u),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[11]||(e[11]=o=>j(M.value))}),a(s(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[12]||(e[12]=o=>g.value=!1)})])])]),_:1},8,["visible"])]))}},Ie=Y(Ee,[["__scopeId","data-v-6e6a2962"]]);export{Ie as default};
