import{_ as C,r as n,z as D,o as U,c as B,a as s,f as h,b as t,u as o,C as N,p as L,i as S,w as d,j,A as K,D as z,e as M,B as _,x as O,t as g,s as E,E as R,g as f,h as T,k as x}from"./index-aOSIQ2DM.js";import{getTodosArticulos as Y}from"./articulosService-CRrrR6mS.js";import{g as q,a as F}from"./ubicacionesService-D6HO7_4s.js";const W={class:"asignar-imeis-container"},G={class:"form-card"},H={class:"form-group"},J={class:"form-group"},P={class:"form-group"},Q={class:"form-actions"},X={class:"dialog-actions"},Z={style:{"white-space":"pre-line"}},ee={class:"dialog-actions"},ae={__name:"AsignarImeis",setup(se){const w=n([]),r=n(null),v=n(""),i=n([]),p=n(""),u=n(!1),b=n(!1),y=n(""),m=n([]),I=n([]),c=n(null),k=D(()=>w.value.filter(l=>l.tipo&&l.tipo.toLowerCase()!=="servicio"));U(async()=>{w.value=await Y(),I.value=await q(),c.value=I.value[0]||null});const A=()=>{const l=v.value.trim();if(l){if(i.value.includes(l)){y.value=`El IMEI "${l}" ya está en la lista.`,b.value=!0,v.value="";return}i.value.push(l),v.value=""}},V=l=>{i.value.splice(l,1)},$=async()=>{if(!(!r.value||i.value.length===0||!c.value)){try{const l=await K(),e=new Set(l.map(a=>a.imei));m.value=i.value.filter(a=>e.has(a))}catch{p.value="Error al validar IMEIs existentes en la base de datos.",u.value=!0;return}if(m.value.length>0){p.value=`Los siguientes IMEIs ya están registrados en el sistema:
${m.value.join(`
`)}
Elimínalos de la lista para continuar.`,u.value=!0;return}try{await z(r.value.nombre,i.value),await F(c.value.id,i.value),p.value=`${i.value.length} IMEIs asignados al artículo "${r.value.nombre}" y a la ubicación "${c.value.nombre}" correctamente.`,i.value=[],m.value=[]}catch{p.value="Ocurrió un error al asignar los IMEIs."}u.value=!0}};return(l,e)=>(M(),B("div",W,[e[10]||(e[10]=s("h2",null,"Asignar IMEIs a Artículo",-1)),s("div",G,[s("div",H,[e[7]||(e[7]=s("label",{for:"articulo"},[h(" Artículo "),s("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),t(o(_),{id:"articulo",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=a=>r.value=a),options:k.value,optionLabel:"sku",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),s("div",J,[e[8]||(e[8]=s("label",{for:"ubicacionDestino"},"Ubicación destino",-1)),t(o(_),{id:"ubicacionDestino",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),options:I.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["modelValue","options"])]),s("div",P,[e[9]||(e[9]=s("label",{for:"nuevoImei"},"IMEI:",-1)),t(o(O),{id:"nuevoImei",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!r.value,onKeydown:N(L(A,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),i.value.length?(M(),S(o(T),{key:0,value:i.value,class:"imeis-table",rows:5,paginator:i.value.length>5,responsiveLayout:"scroll",emptyMessage:"No hay IMEIs agregados."},{default:d(()=>[t(o(E),{header:"#",style:{width:"50px"}},{body:d(a=>[h(g(a.index+1),1)]),_:1}),t(o(E),{header:"IMEI"},{body:d(a=>[s("span",{class:R({"imei-existente":m.value.includes(a.data)})},g(a.data),3)]),_:1}),t(o(E),{header:"Eliminar",style:{width:"70px"}},{body:d(a=>[t(o(f),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:le=>V(a.index)},null,8,["onClick"])]),_:1})]),_:1},8,["value","paginator"])):j("",!0)]),s("div",Q,[t(o(f),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:$,class:"p-button-success",disabled:i.value.length===0},null,8,["disabled"])])]),t(o(x),{visible:u.value,"onUpdate:visible":e[4]||(e[4]=a=>u.value=a),header:"Resultado",modal:!0,closable:!1},{default:d(()=>[s("p",null,g(p.value),1),s("div",X,[t(o(f),{label:"Aceptar",icon:"pi pi-check",onClick:e[3]||(e[3]=a=>u.value=!1),autofocus:""})])]),_:1},8,["visible"]),t(o(x),{visible:b.value,"onUpdate:visible":e[6]||(e[6]=a=>b.value=a),header:"Advertencia",modal:!0,closable:!1},{default:d(()=>[s("p",Z,g(y.value),1),s("div",ee,[t(o(f),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>b.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},ne=C(ae,[["__scopeId","data-v-9fb5d8c7"]]);export{ne as default};
