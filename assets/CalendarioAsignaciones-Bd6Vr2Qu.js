import{_ as L,r as n,o as N,z as R,c as V,a as t,b as a,u as o,w as f,e as _,C as D,x as T,s as r,g as m,h as U,f as b,t as g,j as y,k as j,ak as E}from"./index-CaCxCvVf.js";import{g as M}from"./asignacionesService-bXvsicRQ.js";import{g as q}from"./clientesService-C4u6iobw.js";const z={class:"asignaciones-lista"},I={class:"filtros"},O={key:0},G={key:0},H={__name:"CalendarioAsignaciones",setup(J){const u=n([]),C=n(!1),c=n(!1),s=n(null),d=n(null),v=n(null),p=n(""),w=E(),h=n([]),k=n([]),$=n({});N(async()=>{C.value=!0;const[i,l]=await Promise.all([M(),q()]);$.value=Object.fromEntries(l.map(e=>[e.id,e.nombre])),u.value=i.map(e=>({...e,cliente:$.value[e.cliente_id]||e.cliente_nombre||e.cliente_id||"",tecnico:e.tecnico||e.tecnico_nombre||""})),h.value=[...new Set(u.value.map(e=>e.tecnico).filter(Boolean))].map(e=>({tecnico:e})),k.value=[...new Set(u.value.map(e=>e.cliente).filter(Boolean))].map(e=>({cliente:e})),C.value=!1});const A=R(()=>{let i=[...u.value];if(d.value&&(i=i.filter(l=>l.tecnico===d.value)),v.value&&(i=i.filter(l=>l.cliente===v.value)),p.value){const l=p.value.toLowerCase();i=i.filter(e=>e.tecnico&&e.tecnico.toLowerCase().includes(l)||e.cliente&&e.cliente.toLowerCase().includes(l)||e.venta_id&&String(e.venta_id).includes(l)||e.fecha_servicio&&e.fecha_servicio.includes(l))}return i.sort((l,e)=>new Date(l.fecha_servicio)-new Date(e.fecha_servicio))});function F(i){s.value=i,c.value=!0}function S(){c.value=!1,w.push(`/asignacion/${s.value.id}`)}function x(i){w.push(`/reporte-servicio/${i.id}`)}return(i,l)=>(_(),V("div",z,[l[9]||(l[9]=t("h2",null,"Asignaciones a Técnicos",-1)),t("div",I,[a(o(D),{modelValue:d.value,"onUpdate:modelValue":l[0]||(l[0]=e=>d.value=e),options:h.value,optionLabel:"tecnico",optionValue:"tecnico",placeholder:"Filtrar por técnico",class:"mr-2",showClear:""},null,8,["modelValue","options"]),a(o(D),{modelValue:v.value,"onUpdate:modelValue":l[1]||(l[1]=e=>v.value=e),options:k.value,optionLabel:"cliente",optionValue:"cliente",placeholder:"Filtrar por cliente",class:"mr-2",showClear:""},null,8,["modelValue","options"]),a(o(T),{modelValue:p.value,"onUpdate:modelValue":l[2]||(l[2]=e=>p.value=e),placeholder:"Buscar...",class:"mr-2"},null,8,["modelValue"])]),a(o(U),{value:A.value,loading:C.value,responsiveLayout:"scroll"},{default:f(()=>[a(o(r),{field:"fecha_servicio",header:"Fecha de Servicio",sortable:""}),a(o(r),{field:"tecnico",header:"Técnico",sortable:""}),a(o(r),{field:"venta_id",header:"Nota de Venta",sortable:""}),a(o(r),{field:"cliente",header:"Cliente",sortable:""}),a(o(r),{header:"Acciones"},{body:f(e=>[a(o(m),{label:"Ver Detalle",icon:"pi pi-search",class:"mr-2",onClick:B=>F(e.data)},null,8,["onClick"]),a(o(m),{label:"Agregar Reporte",icon:"pi pi-plus",class:"p-button-success",onClick:B=>x(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),a(o(j),{visible:c.value,"onUpdate:visible":l[4]||(l[4]=e=>c.value=e),header:"Resumen de Asignación",modal:!0},{footer:f(()=>[a(o(m),{label:"Ver Detalle",icon:"pi pi-search",onClick:S}),a(o(m),{label:"Cerrar",icon:"pi pi-times",class:"p-button-secondary",onClick:l[3]||(l[3]=e=>c.value=!1)})]),default:f(()=>[s.value?(_(),V("div",O,[t("p",null,[l[5]||(l[5]=t("b",null,"Técnico:",-1)),b(" "+g(s.value.tecnico),1)]),t("p",null,[l[6]||(l[6]=t("b",null,"Fecha de servicio:",-1)),b(" "+g(s.value.fecha_servicio),1)]),t("p",null,[l[7]||(l[7]=t("b",null,"Nota de venta:",-1)),b(" "+g(s.value.venta_id),1)]),s.value.cliente?(_(),V("p",G,[l[8]||(l[8]=t("b",null,"Cliente:",-1)),b(" "+g(s.value.cliente),1)])):y("",!0)])):y("",!0)]),_:1},8,["visible"])]))}},W=L(H,[["__scopeId","data-v-0bc5f82f"]]);export{W as default};
