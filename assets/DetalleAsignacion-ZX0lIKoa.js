import{av as x,r as g,o,D as C,w as F,a as e,b as _,d as f,ai as R,i as V,j as I,_ as A,l as B,k as T,c as d,t as n,v as b,J as U,K as G,p as D,ao as O}from"./index-LITIrOfu.js";import{g as E}from"./asignacionesService-CtKy7_5I.js";import{a as M,g as P}from"./ventasService-2K1KZ7Bp.js";import{g as j}from"./clientesService-CAgIzlJv.js";const J=async v=>await x.post("https://64.227.15.111/reportes-servicio",v),S=async v=>(await x.get(`https://64.227.15.111/reportes-servicio?asignacion_id=${v}`)).data,K={class:"form-group"},L={class:"form-group"},q={class:"modal-actions"},z={__name:"ReporteServicio",props:{asignacionId:Number,visible:Boolean},emits:["close","saved","update:visible"],setup(v,{emit:y}){const l=v,t=y,r=g({descripcion:"",observaciones:""});function w(){t("update:visible",!1),t("close")}async function u(){await J({...r.value,asignacion_id:l.asignacionId}),t("saved"),w()}return(m,i)=>(o(),C(f(I),{visible:v.visible,"onUpdate:visible":i[2]||(i[2]=c=>t("update:visible",c)),header:"Reporte de Servicio",modal:!0},{default:F(()=>[e("div",K,[i[3]||(i[3]=e("label",null,"Descripción del servicio",-1)),_(f(R),{modelValue:r.value.descripcion,"onUpdate:modelValue":i[0]||(i[0]=c=>r.value.descripcion=c),rows:"3",class:"w-full"},null,8,["modelValue"])]),e("div",L,[i[4]||(i[4]=e("label",null,"Observaciones",-1)),_(f(R),{modelValue:r.value.observaciones,"onUpdate:modelValue":i[1]||(i[1]=c=>r.value.observaciones=c),rows:"2",class:"w-full"},null,8,["modelValue"])]),e("div",q,[_(f(V),{label:"Guardar",icon:"pi pi-save",onClick:u}),_(f(V),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:w})])]),_:1},8,["visible"]))}},H={class:"detalle-asignacion"},Q={key:0},W={class:"asignacion-info"},X={class:"asignacion-value"},Y={class:"asignacion-value"},Z={class:"asignacion-value"},h={class:"asignacion-value"},ee={key:0,class:"venta-detalle-card"},ae={class:"venta-detalle-info"},se={class:"venta-value"},le={class:"venta-value"},ne={class:"venta-value"},ie={class:"detalle-table"},te={key:0},oe={key:0},re={key:3},ue={__name:"DetalleAsignacion",setup(v){const y=O(),l=g(null),t=g(null),r=g([]),w=g(""),u=g(null),m=g(!1),i=B(()=>l.value&&new Date(l.value.fecha_servicio)<=new Date&&!u.value);async function c(){u.value=await S(l.value.id)}return T(async()=>{var a,k;const $=await E();if(l.value=$.find(p=>p.id==y.params.id),(a=l.value)!=null&&a.venta_id){const p=await M();t.value=p.find(s=>s.id==l.value.venta_id)||{},r.value=await P(l.value.venta_id)}if((k=l.value)!=null&&k.cliente_id){const s=(await j()).find(N=>N.id==l.value.cliente_id);w.value=s?s.nombre:""}u.value=await S(l.value.id)}),($,a)=>{var k,p;return o(),d("div",H,[a[20]||(a[20]=e("h2",null,"Detalle de Asignación",-1)),l.value?(o(),d("div",Q,[e("div",W,[e("div",null,[a[4]||(a[4]=e("span",{class:"asignacion-label"},"Técnico:",-1)),e("span",X,n(l.value.tecnico),1)]),e("div",null,[a[5]||(a[5]=e("span",{class:"asignacion-label"},"Fecha de servicio:",-1)),e("span",Y,n(l.value.fecha_servicio),1)]),e("div",null,[a[6]||(a[6]=e("span",{class:"asignacion-label"},"Nota de venta:",-1)),e("span",Z,n(l.value.venta_id),1)]),e("div",null,[a[7]||(a[7]=e("span",{class:"asignacion-label"},"Cliente:",-1)),e("span",h,n(w.value||l.value.cliente_id),1)])]),t.value?(o(),d("div",ee,[a[15]||(a[15]=e("h3",null,"Detalle de la Nota de Venta",-1)),e("div",ae,[e("div",null,[a[8]||(a[8]=e("span",{class:"venta-label"},"Fecha:",-1)),e("span",se,n(((k=t.value.fecha)==null?void 0:k.split("T")[0])||t.value.fecha),1)]),e("div",null,[a[9]||(a[9]=e("span",{class:"venta-label"},"Observaciones:",-1)),e("span",le,n(t.value.observaciones||"Sin observaciones"),1)]),e("div",null,[a[10]||(a[10]=e("span",{class:"venta-label"},"Total:",-1)),e("span",ne,"$"+n((p=t.value.total)==null?void 0:p.toFixed(2)),1)])]),e("table",ie,[e("thead",null,[e("tr",null,[a[11]||(a[11]=e("th",null,"Artículo",-1)),a[12]||(a[12]=e("th",null,"Cantidad",-1)),a[13]||(a[13]=e("th",null,"Precio Unitario",-1)),a[14]||(a[14]=e("th",null,"Subtotal",-1)),r.value&&r.value.some(s=>s.imei)?(o(),d("th",te,"IMEI")):b("",!0)])]),e("tbody",null,[(o(!0),d(U,null,G(r.value,s=>(o(),d("tr",{key:s.id},[e("td",null,n(s.articulo_nombre),1),e("td",null,n(s.cantidad),1),e("td",null,"$"+n(Number(s.precio_unitario).toFixed(2)),1),e("td",null,"$"+n((s.cantidad*s.precio_unitario).toFixed(2)),1),s.imei?(o(),d("td",oe,n(s.imei),1)):b("",!0)]))),128))])])])):b("",!0),i.value?(o(),C(f(V),{key:1,label:"Generar Reporte de Servicio",icon:"pi pi-file-edit",class:"p-button-success",onClick:a[0]||(a[0]=s=>m.value=!0)})):b("",!0),m.value?(o(),C(z,{key:2,asignacionId:l.value.id,visible:m.value,"onUpdate:visible":a[1]||(a[1]=s=>m.value=s),onClose:a[2]||(a[2]=s=>m.value=!1),onSaved:c},null,8,["asignacionId","visible"])):b("",!0),u.value?(o(),d("div",re,[a[19]||(a[19]=e("h3",null,"Reporte de Servicio",-1)),e("p",null,[a[16]||(a[16]=e("b",null,"Descripción:",-1)),D(" "+n(u.value.descripcion),1)]),e("p",null,[a[17]||(a[17]=e("b",null,"Observaciones:",-1)),D(" "+n(u.value.observaciones),1)]),e("p",null,[a[18]||(a[18]=e("b",null,"Fecha de reporte:",-1)),D(" "+n(u.value.fecha),1)])])):b("",!0)])):b("",!0),_(f(V),{label:"Regresar",icon:"pi pi-arrow-left",onClick:a[3]||(a[3]=s=>$.$router.back()),class:"btn-regresar"})])}}},be=A(ue,[["__scopeId","data-v-7fe54943"]]);export{be as default};
