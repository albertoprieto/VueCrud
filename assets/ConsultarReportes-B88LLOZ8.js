import{_ as H,r as n,o as J,c as T,a as t,b as i,w as f,u as l,d as h,e as y,s as d,f as K,t as A,g as F,h as v,i as N,j as Q,k as $,l as C,v as w,m as W,n as X}from"./index-DKaPuLj0.js";import{_ as Z}from"./NotaVentaPDF-JeoQfaAu.js";import{g as ee,a as ae}from"./ventasService-DCVRaxEV.js";import{g as le}from"./clientesService-BdJJ_DmW.js";import{g as te}from"./asignacionesService-DoA71KrZ.js";import"./_commonjsHelpers-Cpj98o6Y.js";const ie={class:"consultar-reportes-container"},oe={key:0},se={class:"form-group"},ne={class:"form-group"},re={class:"form-group"},ue={class:"form-group"},de={class:"form-group"},ce={class:"modal-actions"},ve={class:"modal-actions"},pe={style:{padding:"1.5rem","text-align":"center"}},me={__name:"ConsultarReportes",setup(fe){const E=n([]),r=n(!1),k=n(!1),b=n(!1),o=n(null),g=n(!1),_=n(null),S=n(null),V=n(null),D=n([]),B={nombre:"GPSubicacion.com",direccion:"Guadalajara",rfc:"RFC123456"};let x=[];const u=n(!1),p=n("");async function M(){r.value=!0;try{const s=await h.get("https://api.gpsubicacionapi.com/reportes-servicio-todos");E.value=s.data,x=await te()}catch{E.value=[],x=[],p.value="Error al cargar los reportes.",u.value=!0}r.value=!1}async function j(s){r.value=!0;const e=x.find(m=>m.id==s.asignacion_id);if(!e||!e.venta_id){r.value=!1,p.value="No se encontró la nota de venta relacionada.",u.value=!0;return}const c=(await ee()).find(m=>m.id==e.venta_id);if(!c){r.value=!1,p.value="No se encontró la nota de venta.",u.value=!0;return}S.value=c;const R=await le();V.value=R.find(m=>m.id===c.cliente_id)||{};const q=await X(),L=await ae(c.id);D.value=L.map(m=>{const U=q.find(Y=>Y.id===m.articulo_id)||{};return{...m,sku:U.sku,nombre:U.nombre}}),k.value=!0,r.value=!1}function G(s){o.value={...s},b.value=!0}async function z(){if(o.value){r.value=!0;try{await h.put(`https://api.gpsubicacionapi.com/reportes-servicio/${o.value.id}`,o.value),await M(),b.value=!1,p.value="Reporte actualizado correctamente.",u.value=!0}catch{p.value="Error al guardar los cambios.",u.value=!0}r.value=!1}}function I(s){_.value=s,g.value=!0}async function O(){if(_.value){r.value=!0;try{await h.delete(`https://api.gpsubicacionapi.com/reportes-servicio/${_.value.id}`),await M(),p.value="Reporte eliminado correctamente.",u.value=!0}catch{p.value="Error al eliminar el reporte.",u.value=!0}g.value=!1,r.value=!1}}function P(s){if(!s)return"";const e=new Date(s),a=String(e.getDate()).padStart(2,"0"),c=String(e.getMonth()+1).padStart(2,"0"),R=e.getFullYear();return`${a}/${c}/${R}`}return J(M),(s,e)=>(y(),T("div",ie,[e[19]||(e[19]=t("h2",{class:"consultar-reportes-title"},"Consultar Reportes de Servicio",-1)),i(l(Q),{value:E.value,responsiveLayout:"scroll",loading:r.value},{default:f(()=>[i(l(d),{field:"tipo_servicio",header:"Tipo"}),i(l(d),{field:"marca",header:"Marca"}),i(l(d),{field:"modelo",header:"Modelo"}),i(l(d),{field:"placas",header:"Placas"}),i(l(d),{field:"nombre_cliente",header:"Cliente"}),i(l(d),{field:"fecha",header:"Fecha"},{body:f(a=>[K(A(P(a.data.fecha)),1)]),_:1}),i(l(d),{field:"nombre_instalador",header:"Instalador"}),i(l(d),{field:"observaciones",header:"Observaciones"}),i(l(d),{header:"Nota de Venta"},{body:f(a=>[a.data.asignacion_id?(y(),F(l(v),{key:0,icon:"pi pi-file-pdf",label:"Ver PDF",size:"small",onClick:c=>j(a.data)},null,8,["onClick"])):N("",!0)]),_:1}),i(l(d),{header:"Acciones"},{body:f(a=>[i(l(v),{icon:"pi pi-pencil",class:"p-button-sm p-button-info",label:"Editar",onClick:c=>G(a.data)},null,8,["onClick"]),i(l(v),{icon:"pi pi-trash",class:"p-button-sm p-button-danger ml-2",label:"Eliminar",onClick:c=>I(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),i(l($),{visible:k.value,"onUpdate:visible":e[1]||(e[1]=a=>k.value=a),header:"Nota de Venta",modal:!0,class:"historico-dialog"},{default:f(()=>[S.value&&V.value&&D.value.length?(y(),F(Z,{key:0,venta:S.value,cliente:V.value,articulos:D.value,empresa:B,"venta-registrada":!0},null,8,["venta","cliente","articulos"])):N("",!0),i(l(v),{label:"Cerrar",icon:"pi pi-times",onClick:e[0]||(e[0]=a=>k.value=!1),class:"mt-3"})]),_:1},8,["visible"]),i(l($),{visible:b.value,"onUpdate:visible":e[8]||(e[8]=a=>b.value=a),header:"Editar Reporte de Servicio",modal:!0},{default:f(()=>[t("form",{onSubmit:W(z,["prevent"])},[o.value?(y(),T("div",oe,[t("div",se,[e[13]||(e[13]=t("label",null,"Tipo de Servicio",-1)),C(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.tipo_servicio=a),class:"w-full"},null,512),[[w,o.value.tipo_servicio]])]),t("div",ne,[e[14]||(e[14]=t("label",null,"Marca",-1)),C(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.marca=a),class:"w-full"},null,512),[[w,o.value.marca]])]),t("div",re,[e[15]||(e[15]=t("label",null,"Modelo",-1)),C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.modelo=a),class:"w-full"},null,512),[[w,o.value.modelo]])]),t("div",ue,[e[16]||(e[16]=t("label",null,"Placas",-1)),C(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.placas=a),class:"w-full"},null,512),[[w,o.value.placas]])]),t("div",de,[e[17]||(e[17]=t("label",null,"Observaciones",-1)),C(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.observaciones=a),class:"w-full"},null,512),[[w,o.value.observaciones]])])])):N("",!0),t("div",ce,[i(l(v),{label:"Guardar",icon:"pi pi-save",type:"submit"}),i(l(v),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary ml-2",onClick:e[7]||(e[7]=a=>b.value=!1),type:"button"})])],32)]),_:1},8,["visible"]),i(l($),{visible:g.value,"onUpdate:visible":e[10]||(e[10]=a=>g.value=a),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:f(()=>[e[18]||(e[18]=t("div",{style:{padding:"1.5rem","text-align":"center"}},[t("span",null,"¿Seguro que deseas eliminar este reporte?")],-1)),t("div",ve,[i(l(v),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:O}),i(l(v),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary ml-2",onClick:e[9]||(e[9]=a=>g.value=!1)})])]),_:1},8,["visible"]),i(l($),{visible:u.value,"onUpdate:visible":e[12]||(e[12]=a=>u.value=a),header:"Mensaje",modal:!0,closable:!1},{default:f(()=>[t("div",pe,[t("span",null,A(p.value),1)]),i(l(v),{label:"Aceptar",icon:"pi pi-check",onClick:e[11]||(e[11]=a=>u.value=!1),class:"mt-3"})]),_:1},8,["visible"])]))}},$e=H(me,[["__scopeId","data-v-b04fafa3"]]);export{$e as default};
