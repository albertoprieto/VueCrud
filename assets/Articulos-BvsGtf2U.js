import{g as G,u as H,a as J,d as Q}from"./articulosService-Tx5LGeDP.js";import{_ as R,r as n,k as W,l as $,c as _,a as l,b as s,d as a,w as c,m as Y,o as C,i as d,g as V,s as f,n as D,t as w,e as Z,p as E,q as I,j as N}from"./index-Dfk-US5Q.js";import{u as U,w as ee,F as oe}from"./FileSaver.min-Bul9EBtc.js";const le={class:"articulos"},se={class:"actions"},ae={class:"articulos-card"},te={class:"modal-content"},ie={class:"modal-title"},re={class:"form-grid"},ne={class:"form-col"},ue={class:"form-group"},de={class:"form-group"},ce={key:0,class:"error-text"},pe={class:"form-group"},me={key:0,class:"error-text"},ve={class:"form-group"},fe={class:"form-col"},be={class:"form-group"},Ve={class:"form-group"},ge={class:"form-group"},we={class:"modal-actions"},ke={class:"dialog-content"},Ae={class:"modal-actions"},ye={class:"dialog-content"},xe={class:"modal-actions"},_e={__name:"Articulos",setup(Ce){const M=n([]),h=n([]),k=n(!0),p=n(!1),t=n({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""}),m=n(""),T=n("nombre"),B=n(1),v=n(!1),g=n(""),b=n(!1),S=n(null),A=async()=>{k.value=!0;try{M.value=await G(),h.value=await Y()}finally{k.value=!1}};W(A);const y=$(()=>{const i={};return h.value.forEach(e=>{i[e.articulo_nombre]||(i[e.articulo_nombre]=[]),i[e.articulo_nombre].push(e)}),M.value.map(e=>{const u=(i[e.nombre]||[]).filter(x=>x.status==="Disponible").length;return Number(e.precioVenta),{...e,existencias:u}})}),F=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(i)||0),L=$(()=>m.value?y.value.filter(i=>{var e,o,u;return((e=i.nombre)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase()))||((o=i.sku)==null?void 0:o.toLowerCase().includes(m.value.toLowerCase()))||((u=i.descripcion)==null?void 0:u.toLowerCase().includes(m.value.toLowerCase()))}):y.value),X=()=>{t.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},p.value=!0},O=()=>{p.value=!1},P=async()=>{if(!t.value.nombre||!t.value.sku){g.value="Por favor, complete los campos obligatorios.",v.value=!0;return}try{const i={...t.value,codigo:t.value.codigo??"",pagina:t.value.pagina??""};t.value.id?await H(i):await J(i),p.value=!1,await A()}catch{g.value="Error al guardar el artículo.",v.value=!0}},K=i=>{t.value={...i},p.value=!0},j=i=>{S.value=i,b.value=!0},q=async i=>{try{await Q(i),await A(),b.value=!1}catch{g.value="Error al eliminar el artículo.",v.value=!0}},z=()=>{const i=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),e=y.value.map(r=>({Artículo:r.nombre,SKU:r.sku,Tipo:r.tipo,Unidad:r.unidad,"Precio de venta":i.format(r.precioVenta),"Existencias en mano":r.existencias,Vendidos:r.vendidos,"Total inventario":i.format(r.precioVenta*r.existencias),"Total vendidos (MXN)":i.format(r.totalVendido),Descripción:r.descripcion,Impuesto:r.impuesto})),o=U.json_to_sheet(e),u=U.book_new();U.book_append_sheet(u,o,"Artículos");const x=ee(u,{bookType:"xlsx",type:"array"});oe.saveAs(new Blob([x],{type:"application/octet-stream"}),"articulos.xlsx")};return(i,e)=>(C(),_("div",le,[e[22]||(e[22]=l("h2",null,"Artículos",-1)),l("div",se,[s(a(d),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:X}),s(a(d),{label:"Exportar Excel",icon:"pi pi-file-excel",class:"p-button-success",onClick:z}),s(a(V),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),l("div",ae,[s(a(Z),{value:L.value,sortField:T.value,sortOrder:B.value,responsiveLayout:"scroll",loading:k.value},{default:c(()=>[s(a(f),{field:"sku",header:"SKU",sortable:""}),s(a(f),{field:"nombre",header:"Nombre",sortable:""}),s(a(f),{field:"tipo",header:"Tipo",sortable:""}),s(a(f),{field:"precioVenta",header:"Precio de venta"},{body:c(o=>[D(w(F(o.data.precioVenta)),1)]),_:1}),s(a(f),{header:"Existencias en mano"},{body:c(o=>[D(w(o.data.existencias),1)]),_:1}),s(a(f),{header:"Acciones"},{body:c(o=>[s(a(d),{icon:"pi pi-pencil",class:"p-button-text",onClick:u=>K(o.data)},null,8,["onClick"]),s(a(d),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:u=>j(o.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),s(a(N),{visible:p.value,"onUpdate:visible":e[8]||(e[8]=o=>p.value=o),header:t.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:c(()=>[l("div",te,[l("h3",ie,w(t.value.id?"Editar Artículo":"Nuevo Artículo"),1),l("div",re,[l("div",ne,[l("div",ue,[e[14]||(e[14]=l("label",{for:"tipo"},"Tipo:",-1)),s(a(E),{id:"tipo",modelValue:t.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=o=>t.value.tipo=o),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),l("div",de,[e[15]||(e[15]=l("label",{for:"nombre"},"Nombre:",-1)),s(a(V),{id:"nombre",modelValue:t.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>t.value.nombre=o),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),t.value.nombre?I("",!0):(C(),_("small",ce,"Obligatorio."))]),l("div",pe,[e[16]||(e[16]=l("label",{for:"sku"},"SKU:",-1)),s(a(V),{id:"sku",modelValue:t.value.sku,"onUpdate:modelValue":e[3]||(e[3]=o=>t.value.sku=o),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),t.value.sku?I("",!0):(C(),_("small",me,"Obligatorio."))]),l("div",ve,[e[17]||(e[17]=l("label",{for:"unidad"},"Unidad:",-1)),s(a(E),{id:"unidad",modelValue:t.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=o=>t.value.unidad=o),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])])]),l("div",fe,[l("div",be,[e[18]||(e[18]=l("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),s(a(V),{id:"precioVenta",modelValue:t.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=o=>t.value.precioVenta=o),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])]),l("div",Ve,[e[19]||(e[19]=l("label",{for:"impuesto"},"Impuesto:",-1)),s(a(E),{id:"impuesto",modelValue:t.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=o=>t.value.impuesto=o),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),l("div",ge,[e[20]||(e[20]=l("label",{for:"descripcion"},"Descripción:",-1)),s(a(V),{id:"descripcion",modelValue:t.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=o=>t.value.descripcion=o),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])])])]),l("div",we,[s(a(d),{label:"Guardar",icon:"pi pi-save",onClick:P}),s(a(d),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:O})])])]),_:1},8,["visible","header"]),s(a(N),{visible:v.value,"onUpdate:visible":e[10]||(e[10]=o=>v.value=o),header:"Error",modal:!0,closable:!1},{default:c(()=>[l("div",ke,[l("p",null,w(g.value),1),l("div",Ae,[s(a(d),{label:"Aceptar",icon:"pi pi-check",onClick:e[9]||(e[9]=o=>v.value=!1)})])])]),_:1},8,["visible"]),s(a(N),{visible:b.value,"onUpdate:visible":e[13]||(e[13]=o=>b.value=o),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:c(()=>[l("div",ye,[e[21]||(e[21]=l("p",null,"¿Eliminar este artículo?",-1)),l("div",xe,[s(a(d),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[11]||(e[11]=o=>q(S.value))}),s(a(d),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[12]||(e[12]=o=>b.value=!1)})])])]),_:1},8,["visible"])]))}},Me=R(_e,[["__scopeId","data-v-b68d601f"]]);export{Me as default};
