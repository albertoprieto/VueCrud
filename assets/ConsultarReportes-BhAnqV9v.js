import{_ as L,r as s,o as H,c as N,a as t,b as i,w as f,u as l,d as h,e as y,s as n,f as A,g as v,h as M,i as J,j as E,k as C,v as w,l as K,t as Q,m as W}from"./index-dE5x1ZbV.js";import{_ as X}from"./NotaVentaPDF-xL_UepNi.js";import{g as Y,a as Z}from"./ventasService-BxkkrZWJ.js";import{g as ee}from"./clientesService-Di7fQTNN.js";import{g as ae}from"./asignacionesService-Ce0FrPmr.js";import"./_commonjsHelpers-Cpj98o6Y.js";const le={class:"consultar-reportes-container"},ie={key:0},te={class:"form-group"},oe={class:"form-group"},se={class:"form-group"},ne={class:"form-group"},re={class:"form-group"},ue={class:"modal-actions"},de={class:"modal-actions"},ve={style:{padding:"1.5rem","text-align":"center"}},ce={__name:"ConsultarReportes",setup(pe){const _=s([]),r=s(!1),k=s(!1),b=s(!1),o=s(null),g=s(!1),V=s(null),$=s(null),D=s(null),S=s([]),T={nombre:"GPSubicacion.com",direccion:"Guadalajara",rfc:"RFC123456"};let x=[];const d=s(!1),c=s("");async function R(){r.value=!0;try{const u=await h.get("https://api.gpsubicacionapi.com//reportes-servicio-todos");_.value=u.data,x=await ae()}catch{_.value=[],x=[],c.value="Error al cargar los reportes.",d.value=!0}r.value=!1}async function B(u){r.value=!0;const e=x.find(p=>p.id==u.asignacion_id);if(!e||!e.venta_id){r.value=!1,c.value="No se encontró la nota de venta relacionada.",d.value=!0;return}const m=(await Y()).find(p=>p.id==e.venta_id);if(!m){r.value=!1,c.value="No se encontró la nota de venta.",d.value=!0;return}$.value=m;const z=await ee();D.value=z.find(p=>p.id===m.cliente_id)||{};const O=await W(),P=await Z(m.id);S.value=P.map(p=>{const U=O.find(q=>q.id===p.articulo_id)||{};return{...p,sku:U.sku,nombre:U.nombre}}),k.value=!0,r.value=!1}function j(u){o.value={...u},b.value=!0}async function F(){if(o.value){r.value=!0;try{await h.put(`https://api.gpsubicacionapi.com//reportes-servicio/${o.value.id}`,o.value),await R(),b.value=!1,c.value="Reporte actualizado correctamente.",d.value=!0}catch{c.value="Error al guardar los cambios.",d.value=!0}r.value=!1}}function G(u){V.value=u,g.value=!0}async function I(){if(V.value){r.value=!0;try{await h.delete(`https://api.gpsubicacionapi.com//reportes-servicio/${V.value.id}`),await R(),c.value="Reporte eliminado correctamente.",d.value=!0}catch{c.value="Error al eliminar el reporte.",d.value=!0}g.value=!1,r.value=!1}}return H(R),(u,e)=>(y(),N("div",le,[e[19]||(e[19]=t("h2",{class:"consultar-reportes-title"},"Consultar Reportes de Servicio",-1)),i(l(J),{value:_.value,responsiveLayout:"scroll",loading:r.value},{default:f(()=>[i(l(n),{field:"id",header:"ID"}),i(l(n),{field:"asignacion_id",header:"Asignación"}),i(l(n),{field:"tipo_servicio",header:"Tipo de Servicio"}),i(l(n),{field:"marca",header:"Marca"}),i(l(n),{field:"modelo",header:"Modelo"}),i(l(n),{field:"placas",header:"Placas"}),i(l(n),{field:"nombre_cliente",header:"Cliente"}),i(l(n),{field:"fecha",header:"Fecha"}),i(l(n),{field:"nombre_instalador",header:"Instalador"}),i(l(n),{field:"observaciones",header:"Observaciones"}),i(l(n),{header:"Nota de Venta"},{body:f(a=>[a.data.asignacion_id?(y(),A(l(v),{key:0,icon:"pi pi-file-pdf",label:"Ver PDF",size:"small",onClick:m=>B(a.data)},null,8,["onClick"])):M("",!0)]),_:1}),i(l(n),{header:"Acciones"},{body:f(a=>[i(l(v),{icon:"pi pi-pencil",class:"p-button-sm p-button-info",label:"Editar",onClick:m=>j(a.data)},null,8,["onClick"]),i(l(v),{icon:"pi pi-trash",class:"p-button-sm p-button-danger ml-2",label:"Eliminar",onClick:m=>G(a.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value","loading"]),i(l(E),{visible:k.value,"onUpdate:visible":e[1]||(e[1]=a=>k.value=a),header:"Nota de Venta",modal:!0,class:"historico-dialog"},{default:f(()=>[$.value&&D.value&&S.value.length?(y(),A(X,{key:0,venta:$.value,cliente:D.value,articulos:S.value,empresa:T,"venta-registrada":!0},null,8,["venta","cliente","articulos"])):M("",!0),i(l(v),{label:"Cerrar",icon:"pi pi-times",onClick:e[0]||(e[0]=a=>k.value=!1),class:"mt-3"})]),_:1},8,["visible"]),i(l(E),{visible:b.value,"onUpdate:visible":e[8]||(e[8]=a=>b.value=a),header:"Editar Reporte de Servicio",modal:!0},{default:f(()=>[t("form",{onSubmit:K(F,["prevent"])},[o.value?(y(),N("div",ie,[t("div",te,[e[13]||(e[13]=t("label",null,"Tipo de Servicio",-1)),C(t("input",{"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.tipo_servicio=a),class:"w-full"},null,512),[[w,o.value.tipo_servicio]])]),t("div",oe,[e[14]||(e[14]=t("label",null,"Marca",-1)),C(t("input",{"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.marca=a),class:"w-full"},null,512),[[w,o.value.marca]])]),t("div",se,[e[15]||(e[15]=t("label",null,"Modelo",-1)),C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.modelo=a),class:"w-full"},null,512),[[w,o.value.modelo]])]),t("div",ne,[e[16]||(e[16]=t("label",null,"Placas",-1)),C(t("input",{"onUpdate:modelValue":e[5]||(e[5]=a=>o.value.placas=a),class:"w-full"},null,512),[[w,o.value.placas]])]),t("div",re,[e[17]||(e[17]=t("label",null,"Observaciones",-1)),C(t("textarea",{"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.observaciones=a),class:"w-full"},null,512),[[w,o.value.observaciones]])])])):M("",!0),t("div",ue,[i(l(v),{label:"Guardar",icon:"pi pi-save",type:"submit"}),i(l(v),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary ml-2",onClick:e[7]||(e[7]=a=>b.value=!1),type:"button"})])],32)]),_:1},8,["visible"]),i(l(E),{visible:g.value,"onUpdate:visible":e[10]||(e[10]=a=>g.value=a),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:f(()=>[e[18]||(e[18]=t("div",{style:{padding:"1.5rem","text-align":"center"}},[t("span",null,"¿Seguro que deseas eliminar este reporte?")],-1)),t("div",de,[i(l(v),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:I}),i(l(v),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary ml-2",onClick:e[9]||(e[9]=a=>g.value=!1)})])]),_:1},8,["visible"]),i(l(E),{visible:d.value,"onUpdate:visible":e[12]||(e[12]=a=>d.value=a),header:"Mensaje",modal:!0,closable:!1},{default:f(()=>[t("div",ve,[t("span",null,Q(c.value),1)]),i(l(v),{label:"Aceptar",icon:"pi pi-check",onClick:e[11]||(e[11]=a=>d.value=!1),class:"mt-3"})]),_:1},8,["visible"])]))}},ke=L(ce,[["__scopeId","data-v-48a35909"]]);export{ke as default};
