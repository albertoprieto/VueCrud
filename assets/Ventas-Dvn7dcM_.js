import{u as T}from"./useVentas-DdHTMkjk.js";import{_ as j,r as q,c as n,a as l,b as i,d as e,w as u,t as c,ah as G,o,q as g,g as k,s as r,v as p,p as w,i as V,J as y,K as S,e as J,j as K}from"./index-cm-GLTEx.js";import"./clientesService-BmuydBvf.js";const O={class:"ventas-container"},z={class:"ventas-card"},H={class:"ventas-form-header"},Q={class:"ventas-form-col"},W={class:"ventas-form-col"},X={key:0},Y={key:1},Z={key:0,class:"error-text"},P={class:"imei-cell"},aa={key:0},ea={key:0},ta={class:"imei-value"},ia={class:"mb-2"},la={class:"mb-2 acciones-footer"},da={__name:"Ventas",setup(na){const{today:U,clientes:$,articulosDisponibles:x,ventas:oa,ventaSeleccionada:sa,detalleVenta:ua,imeis:ca,showDialog:b,venta:s,totalVenta:M,articulosConStock:f,getStockDisponible:_,imeisDisponiblesPorArticulo:F,mostrarColumnaIMEI:L,addArticulo:N,removeArticulo:D,validateCantidad:E,onArticuloChange:B,guardarVenta:R,cargarDetalleVenta:ra}=T();q(!1);const v=h=>{const t=x.value.find(a=>a.id===h);return t&&t.tipo&&t.tipo.toLowerCase()==="servicio"};return(h,t)=>(o(),n("div",O,[t[10]||(t[10]=l("h2",{class:"ventas-title"},"Registrar Nota de Venta",-1)),l("div",z,[l("div",H,[l("div",Q,[t[5]||(t[5]=l("label",{class:"mb-2"},"Cliente",-1)),i(e(g),{modelValue:e(s).cliente_id,"onUpdate:modelValue":t[0]||(t[0]=a=>e(s).cliente_id=a),options:e($),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full"},null,8,["modelValue","options"])]),l("div",W,[t[6]||(t[6]=l("label",null,"Fecha",-1)),i(e(k),{modelValue:e(s).fecha,"onUpdate:modelValue":t[1]||(t[1]=a=>e(s).fecha=a),value:e(U),readonly:"",class:"fecha-input"},null,8,["modelValue","value"])])]),t[9]||(t[9]=l("h3",null,"Artículos",-1)),i(e(J),{value:e(s).articulos,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[i(e(r),{header:"Artículo"},{body:u(a=>[i(e(g),{modelValue:a.data.articulo_id,"onUpdate:modelValue":d=>a.data.articulo_id=d,options:e(f)(a.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:d=>e(B)(a.data.articulo_id,a.data),disabled:e(f)(a.data).length===0},null,8,["modelValue","onUpdate:modelValue","options","onChange","disabled"])]),_:1}),i(e(r),{header:"Stock"},{body:u(a=>[v(a.data.articulo_id)?(o(),n("span",X,"NA")):(o(),n("span",Y,c(e(_)(a.data.articulo_id,a.data)),1))]),_:1}),i(e(r),{field:"cantidad",header:"Cantidad"},{body:u(a=>[i(e(k),{type:"number",modelValue:a.data.cantidad,"onUpdate:modelValue":d=>a.data.cantidad=d,modelModifiers:{number:!0},min:1,max:v(a.data.articulo_id)?null:e(_)(a.data.articulo_id,a.data),class:"w-full",disabled:!a.data.articulo_id,onInput:d=>e(E)(a.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"]),!v(a.data.articulo_id)&&a.data.cantidad>e(_)(a.data.articulo_id,a.data)?(o(),n("small",Z," Máx: "+c(e(_)(a.data.articulo_id,a.data)),1)):p("",!0)]),_:1}),i(e(r),{field:"precio_unitario",header:"Precio"},{body:u(a=>[l("span",null,c(a.data.precio_unitario.toFixed(2)),1)]),_:1}),i(e(r),{field:"subtotal",header:"Subtotal"},{body:u(a=>[w(c((a.data.cantidad*a.data.precio_unitario).toFixed(2)),1)]),_:1}),i(e(r),{header:"Acciones"},{body:u(a=>[i(e(V),{icon:"pi pi-trash",class:"p-button-danger p-button-sm",onClick:d=>e(D)(a.index)},null,8,["onClick"])]),_:1}),i(e(r),{header:"IMEI"},{body:u(a=>[l("div",P,[v(a.data.articulo_id)?(o(),n("span",aa,"NA")):e(L)(a.data.articulo_id)?(o(),n(y,{key:1},[(o(!0),n(y,null,S(a.data.cantidad,d=>(o(),n("div",{key:d,style:{"margin-bottom":"0.2em"}},[i(e(g),{modelValue:a.data.imeis[d-1],"onUpdate:modelValue":m=>a.data.imeis[d-1]=m,options:e(F)(a.data.articulo_id,a.data,d-1),optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full imei-dropdown",disabled:!a.data.articulo_id,filter:"",filterMatchMode:"custom",filterFunction:(m,C)=>{var A,I;return((A=m.imei)==null?void 0:A.includes(C))||((I=m.imei)==null?void 0:I.slice(-5).includes(C))}},null,8,["modelValue","onUpdate:modelValue","options","disabled","filterFunction"])]))),128)),a.data.imeis&&a.data.imeis.length?(o(),n("div",ea,[h.imei?(o(!0),n(y,{key:0},S(a.data.imeis,(d,m)=>(o(),n("span",{key:d,class:"imei-seleccionado"},[w(" IMEI "+c(m+1)+": ",1),l("span",ta,c(d),1)]))),128)):p("",!0)])):p("",!0)],64)):p("",!0)])]),_:1})]),_:1},8,["value"]),i(e(V),{label:"Agregar Artículo",icon:"pi pi-plus",class:"mb-2",onClick:e(N),disabled:e(f)().length===0},null,8,["onClick","disabled"]),l("div",ia,[t[7]||(t[7]=l("label",null,"Observaciones",-1)),i(e(k),{modelValue:e(s).observaciones,"onUpdate:modelValue":t[2]||(t[2]=a=>e(s).observaciones=a),class:"w-full"},null,8,["modelValue"])]),l("div",la,[l("strong",null,"Total: $"+c(e(M).toFixed(2)),1),i(e(V),{label:"Guardar Venta",class:"mb-2",onClick:e(R),disabled:!e(s).cliente_id||e(s).articulos.length===0},null,8,["onClick","disabled"])]),i(e(K),{visible:e(b),"onUpdate:visible":t[4]||(t[4]=a=>G(b)?b.value=a:null),header:"Venta registrada",closable:!1,modal:!0,class:"ventas-dialog"},{default:u(()=>[t[8]||(t[8]=l("p",null,"La nota de venta se registró correctamente.",-1)),i(e(V),{label:"Aceptar",icon:"pi pi-check",onClick:t[3]||(t[3]=a=>b.value=!1),autofocus:""})]),_:1},8,["visible"])])]))}},va=j(da,[["__scopeId","data-v-4043ff86"]]);export{va as default};
