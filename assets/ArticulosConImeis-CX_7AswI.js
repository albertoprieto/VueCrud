import{_ as O,r as l,l as k,k as $,c as L,a as c,b as s,d as a,w as u,v as U,o as j,g as T,i as C,s as i,e as F,j as D}from"./index-9q8L-fBU.js";import{g as X}from"./articulosService-DYFFFfM1.js";import{u as f,w as K,F as P}from"./FileSaver.min-Bul9EBtc.js";const R={class:"articulos-con-imeis"},q={class:"table-actions"},z={class:"articulos-imeis-card"},G={class:"dialog-content"},H={__name:"ArticulosConImeis",setup(J){const d=l([]),_=l([]),m=l(!0),p=l(!1),b=l([]),n=l(""),I=l("articulo_nombre"),h=l(1),v=k(()=>{const o={};return d.value.forEach(e=>{o[e.articulo_nombre]||(o[e.articulo_nombre]=[]),o[e.articulo_nombre].push(e)}),Object.entries(o).map(([e,r])=>({articulo_nombre:e,cantidad:r.length,imeis:r}))}),M=k(()=>n.value?v.value.filter(o=>{var e;return(e=o.articulo_nombre)==null?void 0:e.toLowerCase().includes(n.value.toLowerCase())}):v.value),A=o=>{const e=v.value.find(r=>r.articulo_nombre===o);b.value=e?e.imeis:[],p.value=!0},V=o=>{I.value=o.sortField,h.value=o.sortOrder},S=async()=>{m.value=!0;try{d.value=await U(),_.value=await X()}finally{m.value=!1}},B=()=>{const o={};d.value.forEach(t=>{o[t.articulo_nombre]||(o[t.articulo_nombre]=[]),o[t.articulo_nombre].push(t)});const e=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),r=_.value.map(t=>{var E;const y=((E=o[t.nombre])==null?void 0:E.length)||0,w=Number(t.precioVenta)||0;return{Artículo:t.nombre,SKU:t.sku,Tipo:t.tipo,Unidad:t.unidad,"Precio unitario":e.format(w),"Cantidad en stock":y,"Total inventario":e.format(w*y),Descripción:t.descripcion,Impuesto:t.impuesto}}),g=f.json_to_sheet(r),x=f.book_new();f.book_append_sheet(x,g,"Inventario");const N=K(x,{bookType:"xlsx",type:"array"});P.saveAs(new Blob([N],{type:"application/octet-stream"}),"inventario.xlsx")};return $(S),(o,e)=>(j(),L("div",R,[e[2]||(e[2]=c("h2",null,"Stock por Artículo",-1)),c("div",q,[s(a(T),{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=r=>n.value=r),placeholder:"Filtrar por artículo...",class:"p-inputtext-sm",style:{"max-width":"250px"}},null,8,["modelValue"]),s(a(C),{icon:"pi pi-file-excel",class:"p-button-success p-button-sm",label:"Exportar Excel",style:{"margin-left":"1rem"},onClick:B})]),c("div",z,[s(a(F),{value:M.value,sortField:I.value,sortOrder:h.value,responsiveLayout:"scroll",onSort:V,loading:m.value},{default:u(()=>[s(a(i),{field:"articulo_nombre",header:"Artículo",sortable:""}),s(a(i),{field:"cantidad",header:"Cantidad IMEIs",sortable:""}),s(a(i),{header:"Ver IMEIs"},{body:u(r=>[s(a(C),{label:"Ver IMEIs",onClick:g=>A(r.data.articulo_nombre)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),s(a(D),{visible:p.value,"onUpdate:visible":e[1]||(e[1]=r=>p.value=r),header:"IMEIs Asociados",modal:!0,closable:!0},{default:u(()=>[c("div",G,[s(a(F),{value:b.value,responsiveLayout:"scroll"},{default:u(()=>[s(a(i),{field:"imei",header:"IMEI"}),s(a(i),{field:"status",header:"Estado"}),s(a(i),{field:"registeredBy",header:"Registró"}),s(a(i),{field:"date",header:"Fecha"})]),_:1},8,["value"])])]),_:1},8,["visible"])]))}},Z=O(H,[["__scopeId","data-v-9e104f8f"]]);export{Z as default};
