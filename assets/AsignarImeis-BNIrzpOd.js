import{_ as T,r as o,l as A,k as j,c as I,a as l,n as M,b as u,d as r,v as F,x as K,F as q,y as z,q as x,z as R,A as Y,w as C,m as U,B as P,o as E,p as V,g as W,C as G,t as k,i as y,j as _}from"./index-CYB56wGJ.js";import{getTodosArticulos as H}from"./articulosService-2CJv70N7.js";import{g as J,a as D}from"./ubicacionesService-CH5Z2c13.js";const Q={class:"asignar-imeis-container"},X={class:"form-card"},Z={class:"form-group"},ee={class:"form-group"},ae={key:0,class:"imeis-list"},le={class:"form-group"},se={class:"form-group"},ie={key:0,class:"form-group"},oe={class:"form-actions"},te={class:"dialog-actions"},ne={style:{"white-space":"pre-line"}},ue={class:"dialog-actions"},re={__name:"AsignarImeis",setup(ce){const h=o([]),m=o(null),f=o(""),s=o([]),c=o(""),v=o(!1),p=o(!1),w=o(""),b=o([]),g=o([]),t=o(null),d=o(!1),n=o(null),O=A(()=>h.value.filter(i=>i.tipo&&i.tipo.toLowerCase()!=="servicio")),L=A(()=>!d.value||!n.value?g.value:g.value.filter(i=>i.id!==n.value.id));j(async()=>{h.value=await H(),g.value=await J(),t.value=g.value[0]||null,n.value=g.value[0]||null});const B=()=>{const i=f.value.trim();if(i){if(s.value.includes(i)){w.value=`El IMEI "${i}" ya está en la lista.`,p.value=!0,f.value="";return}s.value.push(i),f.value=""}},N=i=>{s.value.splice(i,1)},S=async()=>{if(!(!m.value||s.value.length===0||!t.value)){if(d.value&&n.value&&t.value&&n.value.id===t.value.id){w.value="La ubicación origen y destino no pueden ser la misma.",p.value=!0;return}try{const i=await U(),e=new Set(i.map(a=>a.imei));b.value=s.value.filter(a=>e.has(a))}catch{c.value="Error al validar IMEIs existentes en la base de datos.",v.value=!0;return}if(d.value){if((await U()).filter(a=>s.value.includes(a.imei)&&a.ubicacion_id===n.value.id).length!==s.value.length){w.value="Todos los IMEIs deben existir y estar en la ubicación origen para transferir.",p.value=!0;return}try{await D(t.value.id,s.value,n.value.id),c.value=`${s.value.length} IMEIs transferidos de "${n.value.nombre}" a "${t.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{c.value="Ocurrió un error al transferir los IMEIs."}v.value=!0;return}if(b.value.length>0){c.value=`Los siguientes IMEIs ya están registrados en el sistema:
${b.value.join(`
`)}
Elimínalos de la lista para continuar.`,v.value=!0;return}try{await P(m.value.nombre,s.value),await D(t.value.id,s.value),c.value=`${s.value.length} IMEIs asignados al artículo "${m.value.nombre}" y a la ubicación "${t.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{c.value="Ocurrió un error al asignar los IMEIs."}v.value=!0}};return(i,e)=>(E(),I("div",Q,[e[14]||(e[14]=l("h2",null,"Asignar IMEIs a Artículo",-1)),l("div",X,[l("div",Z,[e[9]||(e[9]=l("label",{for:"articulo"},[M(" Artículo "),l("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),u(r(V),{id:"articulo",modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),options:O.value,optionLabel:"nombre",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),l("div",ee,[e[10]||(e[10]=l("label",{for:"nuevoImei"},"IMEI:",-1)),u(r(W),{id:"nuevoImei",modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=a=>f.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!m.value,onKeydown:F(K(B,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),s.value.length?(E(),I("ul",ae,[(E(!0),I(q,null,z(s.value,(a,$)=>(E(),I("li",{key:$,class:G({"imei-existente":b.value.includes(a)})},[M(k(a)+" ",1),u(r(y),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:ve=>N($)},null,8,["onClick"])],2))),128))])):x("",!0)]),l("div",le,[e[11]||(e[11]=l("label",{for:"ubicacionDestino"}," Ubicación destino ",-1)),u(r(V),{disabled:!d.value,id:"ubicacionDestino",modelValue:t.value,"onUpdate:modelValue":e[2]||(e[2]=a=>t.value=a),options:L.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["disabled","modelValue","options"])]),l("div",se,[l("label",null,[R(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>d.value=a)},null,512),[[Y,d.value]]),e[12]||(e[12]=M(" Transferencia entre ubicaciones "))])]),d.value?(E(),I("div",ie,[e[13]||(e[13]=l("label",{for:"ubicacionOrigen"},"Ubicación origen",-1)),u(r(V),{id:"ubicacionOrigen",modelValue:n.value,"onUpdate:modelValue":e[4]||(e[4]=a=>n.value=a),options:g.value,optionLabel:"nombre",placeholder:"Selecciona ubicación origen",class:"w-full"},null,8,["modelValue","options"])])):x("",!0),l("div",oe,[u(r(y),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:S,class:"p-button-success",disabled:s.value.length===0},null,8,["disabled"])])]),u(r(_),{visible:v.value,"onUpdate:visible":e[6]||(e[6]=a=>v.value=a),header:"Resultado",modal:!0,closable:!1},{default:C(()=>[l("p",null,k(c.value),1),l("div",te,[u(r(y),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>v.value=!1),autofocus:""})])]),_:1},8,["visible"]),u(r(_),{visible:p.value,"onUpdate:visible":e[8]||(e[8]=a=>p.value=a),header:"Advertencia",modal:!0,closable:!1},{default:C(()=>[l("p",ne,k(w.value),1),l("div",ue,[u(r(y),{label:"Aceptar",icon:"pi pi-check",onClick:e[7]||(e[7]=a=>p.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},be=T(re,[["__scopeId","data-v-090263e8"]]);export{be as default};
