import{av as L,_ as j,r as o,k as E,c as w,a as _,b as t,w as r,d as n,o as p,s as b,t as V,I as G,i as u,D as x,v as T,e as M,j as S,q,m as z}from"./index-CFOn2h_C.js";import{_ as J}from"./NotaVentaPDF-Aoj7_-oS.js";import{a as K,c as O,g as Q,d as W,e as X}from"./ventasService-CEkMcAnV.js";import{g as Y}from"./clientesService-w4gg4DxS.js";import"./_commonjsHelpers-Cpj98o6Y.js";const Z="https://64.227.15.111/usuarios",P=async()=>(await L.get(Z)).data,ee={class:"historico-notas-container"},ae={key:0,class:"chip chip-asignado"},ie={key:1,class:"chip chip-sinasignar"},ne={style:{padding:"1.5rem","text-align":"center"}},se={__name:"HistoricoNotasVenta",setup(D){const l=o([]),d=o(!0),g=o(!1),A=o(null),C=o(null),h=o([]),U={nombre:"GPSubicacion.com",direccion:"Guadalajara",rfc:"RFC123456"},v=o(!1),f=o(null),N=o([]),c=o(null),m=o(!1),y=o("");E(async()=>{d.value=!0;const i=await K(),a=await Promise.all(i.map(async e=>{const s=await O(e.id);return{...e,cliente_nombre:String(e.cliente_nombre??""),tecnicoNombre:s?String(s.username):"",status:s?"Asignado":"Sin asignar"}}));l.value=a,d.value=!1});async function I(i){d.value=!0,A.value=i;const a=await Q(i.id),e=await Y();C.value=e.find(k=>k.id===i.cliente_id)||{};const s=await z();h.value=a.map(k=>{const $=s.find(H=>H.id===k.articulo_id)||{};return{...k,sku:$.sku,nombre:$.nombre}}),g.value=!0,d.value=!1}async function R(i){f.value=i;const a=await P();N.value=a.map(e=>({nombre:e.username,id:e.id,perfil:e.perfil})),c.value=i.tecnicoAsignado??null,v.value=!0}async function B(){if(!f.value||!c.value)return;const i=await W(f.value.id,c.value),a=N.value.find(s=>s.id===c.value),e=l.value.findIndex(s=>s.id===f.value.id);if(e!==-1&&a){const s=[...l.value];s[e]={...s[e],tecnicoAsignado:a.id,tecnicoNombre:a.nombre,status:"Asignado"},l.value=s}v.value=!1,y.value=(i==null?void 0:i.message)||"Técnico asignado",m.value=!0}async function F(i){if(!i.id)return;await X(i.id);const a=l.value.findIndex(e=>e.id===i.id);if(a!==-1){const e=[...l.value];e[a]={...e[a],tecnicoAsignado:null,tecnicoNombre:null,status:"Sin asignar"},l.value=e}y.value="Asignación eliminada",m.value=!0}return(i,a)=>(p(),w("div",ee,[a[7]||(a[7]=_("h2",{class:"historico-title"},"Histórico de Notas de Venta",-1)),t(n(M),{value:l.value,loading:d.value,responsiveLayout:"scroll",class:"historico-table"},{default:r(()=>[t(n(b),{field:"id",header:"Folio"}),t(n(b),{field:"cliente_nombre",header:"Cliente"}),t(n(b),{field:"tecnicoNombre",header:"Asignado a"},{body:r(e=>[e.data.tecnicoNombre?(p(),w("span",ae,V(e.data.tecnicoNombre),1)):(p(),w("span",ie,"Sin asignar"))]),_:1}),t(n(b),{field:"status",header:"Status"},{body:r(e=>[_("span",{class:G(["chip",{"chip-asignado":e.data.tecnicoNombre,"chip-sinasignar":!e.data.tecnicoNombre}])},V(e.data.tecnicoNombre?"Asignado":"Sin asignar"),3)]),_:1}),t(n(b),{header:"Acciones"},{body:r(e=>[t(n(u),{icon:"pi pi-file-pdf",label:"PDF",class:"p-button-sm p-button-success",onClick:s=>I(e.data)},null,8,["onClick"]),t(n(u),{icon:e.data.tecnicoNombre?"pi pi-user-edit":"pi pi-user-plus",label:e.data.tecnicoNombre?"Cambiar técnico":"Asignar técnico",class:"p-button-sm p-button-info ml-2",onClick:s=>R(e.data)},null,8,["icon","label","onClick"]),e.data.tecnicoNombre?(p(),x(n(u),{key:0,icon:"pi pi-trash",label:"Eliminar asignación",class:"p-button-sm p-button-danger ml-2",onClick:s=>F(e.data)},null,8,["onClick"])):T("",!0)]),_:1})]),_:1},8,["value","loading"]),t(n(S),{visible:g.value,"onUpdate:visible":a[1]||(a[1]=e=>g.value=e),header:"Nota de Venta",modal:!0,class:"historico-dialog"},{default:r(()=>[A.value&&C.value&&h.value.length?(p(),x(J,{key:0,venta:A.value,cliente:C.value,articulos:h.value,empresa:U,"venta-registrada":!0},null,8,["venta","cliente","articulos"])):T("",!0),t(n(u),{label:"Cerrar",icon:"pi pi-times",onClick:a[0]||(a[0]=e=>g.value=!1),class:"mt-3"})]),_:1},8,["visible"]),t(n(S),{visible:v.value,"onUpdate:visible":a[4]||(a[4]=e=>v.value=e),header:"Asignar Técnico",modal:!0},{default:r(()=>[t(n(q),{modelValue:c.value,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value=e),options:N.value,optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona técnico",class:"w-full mb-3"},null,8,["modelValue","options"]),t(n(u),{label:"Asignar",icon:"pi pi-check",onClick:B,disabled:!c.value},null,8,["disabled"]),t(n(u),{label:"Cancelar",icon:"pi pi-times",onClick:a[3]||(a[3]=e=>v.value=!1),class:"p-button-secondary ml-2"})]),_:1},8,["visible"]),t(n(S),{visible:m.value,"onUpdate:visible":a[6]||(a[6]=e=>m.value=e),header:"Resultado",modal:!0},{default:r(()=>[_("div",ne,[_("span",null,V(y.value),1)]),t(n(u),{label:"Aceptar",icon:"pi pi-check",onClick:a[5]||(a[5]=e=>m.value=!1),class:"mt-3"})]),_:1},8,["visible"])]))}},ue=j(se,[["__scopeId","data-v-ccb07f20"]]);export{ue as default};
