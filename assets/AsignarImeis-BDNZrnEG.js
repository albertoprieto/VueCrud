import{_ as C,r as n,z as U,o as D,A as B,G as N,c as L,a as s,f as h,b as t,u as o,H as K,p as S,i as j,w as d,j as z,B as O,I as R,J as T,e as M,C as _,x as Y,t as g,s as w,K as q,g as I,h as F,k as x}from"./index-CaCxCvVf.js";const G={class:"asignar-imeis-container"},H={class:"form-card"},J={class:"form-group"},W={class:"form-group"},P={class:"form-group"},Q={class:"form-actions"},X={class:"dialog-actions"},Z={style:{"white-space":"pre-line"}},ee={class:"dialog-actions"},ae={__name:"AsignarImeis",setup(se){const y=n([]),u=n(null),v=n(""),i=n([]),p=n(""),r=n(!1),b=n(!1),E=n(""),m=n([]),f=n([]),c=n(null),k=U(()=>y.value.filter(l=>l.tipo&&l.tipo.toLowerCase()!=="servicio"));D(async()=>{y.value=await B(),f.value=await N(),c.value=f.value[0]||null});const A=()=>{const l=v.value.trim();if(l){if(i.value.includes(l)){E.value=`El IMEI "${l}" ya está en la lista.`,b.value=!0,v.value="";return}i.value.push(l),v.value=""}},V=l=>{i.value.splice(l,1)},$=async()=>{if(!(!u.value||i.value.length===0||!c.value)){try{const l=await O(),e=new Set(l.map(a=>a.imei));m.value=i.value.filter(a=>e.has(a))}catch{p.value="Error al validar IMEIs existentes en la base de datos.",r.value=!0;return}if(m.value.length>0){p.value=`Los siguientes IMEIs ya están registrados en el sistema:
${m.value.join(`
`)}
Elimínalos de la lista para continuar.`,r.value=!0;return}try{await R(u.value.nombre,i.value),await T(c.value.id,i.value),p.value=`${i.value.length} IMEIs asignados al artículo "${u.value.nombre}" y a la ubicación "${c.value.nombre}" correctamente.`,i.value=[],m.value=[]}catch{p.value="Ocurrió un error al asignar los IMEIs."}r.value=!0}};return(l,e)=>(M(),L("div",G,[e[10]||(e[10]=s("h2",null,"Asignar IMEIs a Artículo",-1)),s("div",H,[s("div",J,[e[7]||(e[7]=s("label",{for:"articulo"},[h(" Artículo "),s("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),t(o(_),{id:"articulo",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),options:k.value,optionLabel:"sku",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),s("div",W,[e[8]||(e[8]=s("label",{for:"ubicacionDestino"},"Ubicación destino",-1)),t(o(_),{id:"ubicacionDestino",modelValue:c.value,"onUpdate:modelValue":e[1]||(e[1]=a=>c.value=a),options:f.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["modelValue","options"])]),s("div",P,[e[9]||(e[9]=s("label",{for:"nuevoImei"},"IMEI:",-1)),t(o(Y),{id:"nuevoImei",modelValue:v.value,"onUpdate:modelValue":e[2]||(e[2]=a=>v.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!u.value,onKeydown:K(S(A,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),i.value.length?(M(),j(o(F),{key:0,value:i.value,class:"imeis-table",rows:5,paginator:i.value.length>5,responsiveLayout:"scroll",emptyMessage:"No hay IMEIs agregados."},{default:d(()=>[t(o(w),{header:"#",style:{width:"50px"}},{body:d(a=>[h(g(a.index+1),1)]),_:1}),t(o(w),{header:"IMEI"},{body:d(a=>[s("span",{class:q({"imei-existente":m.value.includes(a.data)})},g(a.data),3)]),_:1}),t(o(w),{header:"Eliminar",style:{width:"70px"}},{body:d(a=>[t(o(I),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:le=>V(a.index)},null,8,["onClick"])]),_:1})]),_:1},8,["value","paginator"])):z("",!0)]),s("div",Q,[t(o(I),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:$,class:"p-button-success",disabled:i.value.length===0},null,8,["disabled"])])]),t(o(x),{visible:r.value,"onUpdate:visible":e[4]||(e[4]=a=>r.value=a),header:"Resultado",modal:!0,closable:!1},{default:d(()=>[s("p",null,g(p.value),1),s("div",X,[t(o(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[3]||(e[3]=a=>r.value=!1),autofocus:""})])]),_:1},8,["visible"]),t(o(x),{visible:b.value,"onUpdate:visible":e[6]||(e[6]=a=>b.value=a),header:"Advertencia",modal:!0,closable:!1},{default:d(()=>[s("p",Z,g(E.value),1),s("div",ee,[t(o(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>b.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},oe=C(ae,[["__scopeId","data-v-9fb5d8c7"]]);export{oe as default};
