import{u as A}from"./useVentas-CJYgPUjs.js";import{_ as T,r as _,ag as j,e as p,g as J,w as u,a as t,b as n,u as l,A as x,q as N,s as b,j as L,h as C,k as B,y as K,c as V,i as F,f as I,t as c,J as X,K as q}from"./index-CwOzOBBu.js";import"./clientesService-BQSrsvc9.js";import"./ventasService-BVHeSoRZ.js";const z={class:"ventas-form-header"},G={class:"ventas-form-col"},H={class:"ventas-form-col"},Q={class:"mb-2"},R={class:"modal-actions"},W={__name:"EditarVenta",props:{venta:Object,clientes:Array},emits:["cerrar","guardar"],setup(U,{emit:w}){const v=U,r=w,{articulosConStock:y,getStockDisponible:g,imeisDisponiblesPorArticulo:k,mostrarColumnaIMEI:m,validateCantidad:S,onArticuloChange:D}=A(),f=_(!0);function $(o){return o?/^\d{4}-\d{2}-\d{2}$/.test(o)?o:typeof o=="string"&&(o.includes(" ")||o.includes("T"))?o.split(/[ T]/)[0]:o instanceof Date?o.toISOString().slice(0,10):o:""}const d=_({...v.venta,fecha:$(v.venta.fecha),detalle:v.venta.detalle?JSON.parse(JSON.stringify(v.venta.detalle)):[]});console.log("Fecha inicial recibida:",v.venta.fecha),console.log("ventaEdit inicial:",d.value),j(()=>v.venta,o=>{console.log("Prop venta actualizada:",o),d.value={...o,fecha:$(o.fecha),detalle:o.detalle?JSON.parse(JSON.stringify(o.detalle)):[]},console.log("ventaEdit después de update:",d.value)});function O(){r("guardar",{...d.value}),h()}function h(){f.value=!1,r("cerrar")}return(o,a)=>(p(),J(l(B),{visible:f.value,"onUpdate:visible":a[3]||(a[3]=e=>f.value=e),header:"Editar Nota de Venta",modal:!0,class:"ventas-dialog"},{default:u(()=>[t("div",z,[t("div",G,[a[4]||(a[4]=t("label",{class:"mb-2"},"Cliente",-1)),n(l(x),{modelValue:d.value.cliente_id,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.cliente_id=e),options:U.clientes,optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full",disabled:""},null,8,["modelValue","options"])]),t("div",H,[a[5]||(a[5]=t("label",null,"Fecha",-1)),n(l(N),{modelValue:d.value.fecha,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.fecha=e),type:"date",class:"fecha-input"},null,8,["modelValue"])])]),t("div",Q,[a[6]||(a[6]=t("label",null,"Observaciones",-1)),n(l(N),{modelValue:d.value.observaciones,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.observaciones=e),class:"w-full"},null,8,["modelValue"])]),a[7]||(a[7]=t("h3",null,"Artículos",-1)),n(l(L),{value:d.value.detalle,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[n(l(b),{header:"Artículo"},{body:u(e=>[n(l(x),{modelValue:e.data.articulo_id,"onUpdate:modelValue":i=>e.data.articulo_id=i,options:l(y)(e.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:i=>l(D)(e.data.articulo_id,e.data),disabled:!0},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),n(l(b),{header:"Cantidad"},{body:u(e=>[n(l(N),{type:"number",modelValue:e.data.cantidad,"onUpdate:modelValue":i=>e.data.cantidad=i,modelModifiers:{number:!0},min:1,max:l(m)(e.data.articulo_id)?1:l(g)(e.data.articulo_id,e.data),class:"w-full",disabled:l(m)(e.data.articulo_id),onInput:i=>l(S)(e.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),_:1}),n(l(b),{header:"Precio"},{body:u(e=>[n(l(N),{type:"number",modelValue:e.data.precio_unitario,"onUpdate:modelValue":i=>e.data.precio_unitario=i,modelModifiers:{number:!0},min:"0",step:"0.01",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),n(l(b),{header:"IMEI"},{body:u(e=>[n(l(x),{modelValue:e.data.imei,"onUpdate:modelValue":i=>e.data.imei=i,options:[...l(k)(e.data.articulo_id,e.data)||[],...e.data.imei?[{imei:e.data.imei}]:[]],optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full",disabled:!e.data.articulo_id},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),_:1})]),_:1},8,["value"]),t("div",R,[n(l(C),{label:"Guardar",icon:"pi pi-save",onClick:O}),n(l(C),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:h})])]),_:1},8,["visible"]))}},Y=T(W,[["__scopeId","data-v-99431755"]]),Z={class:"consultar-ventas"},P={class:"filtros"},ee={key:0,class:"detalle-venta-dialog"},ae={class:"mb-2"},le={class:"detalle-table"},te={key:0},ne={key:0},ie={class:"detalle-venta-footer"},oe={class:"detalle-total"},de={key:1},se={__name:"consultarVentas",setup(U){const{ventas:w,cargarDetalleVenta:v,detalleVenta:r}=A(),y=_(""),g=_(!1),k=_(null),m=_(null),S=_(""),D=K(()=>y.value?w.value.filter(a=>{var e;return(e=a.cliente_nombre)==null?void 0:e.toLowerCase().includes(y.value.toLowerCase())}):w.value);function f(a){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(a)||0)}function $(a){return a?/^\d{4}-\d{2}-\d{2}$/.test(a)?a:typeof a=="string"&&(a.includes(" ")||a.includes("T"))?a.split(/[ T]/)[0]:a instanceof Date?a.toISOString().slice(0,10):a:""}async function d(a){k.value=a,await v({data:a}),g.value=!0}async function O(a){await v({data:a}),m.value={...a,detalle:r.value?JSON.parse(JSON.stringify(r.value)):[]},S.value=a.fecha?a.fecha.split(/[ T]/)[0]:""}function h(){}function o(){m.value=null,S.value=""}return(a,e)=>(p(),V("div",Z,[e[11]||(e[11]=t("h2",null,"Consultar Notas de Venta",-1)),t("div",P,[n(l(N),{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=i=>y.value=i),placeholder:"Filtrar por cliente...",class:"mb-2"},null,8,["modelValue"]),n(l(C),{label:"Buscar",icon:"pi pi-search",onClick:h,class:"mb-2"})]),n(l(L),{value:D.value},{default:u(()=>[n(l(b),{field:"id",header:"ID"}),n(l(b),{field:"cliente_nombre",header:"Cliente"}),n(l(b),{field:"fecha",header:"Fecha"},{body:u(i=>[I(c($(i.data.fecha)),1)]),_:1}),n(l(b),{field:"total",header:"Total"},{body:u(i=>[I(c(f(i.data.total)),1)]),_:1}),n(l(b),{header:"Acciones"},{body:u(i=>[n(l(C),{label:"Editar",icon:"pi pi-pencil",class:"p-button-text",onClick:E=>O(i.data)},null,8,["onClick"]),n(l(C),{label:"Ver Detalle",icon:"pi pi-eye",class:"p-button-text",onClick:E=>d(i.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),n(l(B),{visible:g.value,"onUpdate:visible":e[2]||(e[2]=i=>g.value=i),header:"Detalle de Venta",modal:!0},{default:u(()=>{var i,E;return[l(r)&&l(r).length?(p(),V("div",ee,[t("div",ae,[e[3]||(e[3]=t("strong",null,"Fecha de nota:",-1)),I(" "+c($((i=k.value)==null?void 0:i.fecha)||"Sin fecha"),1)]),t("table",le,[t("thead",null,[t("tr",null,[e[4]||(e[4]=t("th",null,"Artículo",-1)),e[5]||(e[5]=t("th",null,"Cantidad",-1)),e[6]||(e[6]=t("th",null,"Precio",-1)),e[7]||(e[7]=t("th",null,"Subtotal",-1)),l(r).some(s=>s.imei)?(p(),V("th",te,"IMEI")):F("",!0)])]),t("tbody",null,[(p(!0),V(X,null,q(l(r),s=>(p(),V("tr",{key:s.id},[t("td",null,c(s.articulo_nombre),1),t("td",null,c(s.cantidad),1),t("td",null,c(f(s.precio_unitario)),1),t("td",null,c(f(s.cantidad*s.precio_unitario)),1),s.imei?(p(),V("td",ne,c(s.imei),1)):F("",!0)]))),128))])]),t("div",ie,[t("div",null,[e[8]||(e[8]=t("strong",null,"Observaciones:",-1)),I(" "+c(((E=k.value)==null?void 0:E.observaciones)||"Sin observaciones"),1)]),t("div",oe,[e[9]||(e[9]=t("strong",null,"Total:",-1)),I(" "+c(f(l(r).reduce((s,M)=>s+M.cantidad*M.precio_unitario,0))),1)])])])):(p(),V("div",de,e[10]||(e[10]=[t("span",null,"No hay detalle disponible.",-1)]))),n(l(C),{label:"Cerrar",onClick:e[1]||(e[1]=s=>g.value.value=!1),class:"detalle-cerrar-btn"})]}),_:1},8,["visible"]),m.value?(p(),J(Y,{venta:m.value,onCerrar:o,key:m.value?m.value.id+"-"+S.value:"empty"},null,8,["venta"])):F("",!0)]))}},me=T(se,[["__scopeId","data-v-e0c88d0d"]]);export{me as default};
