import{getTodosArticulos as j,updateArticulo as q,addArticulo as z,deleteArticulo as G}from"./articulosService-2CJv70N7.js";import{_ as H,r as d,k as J,l as x,c as g,a as l,b as i,d as s,w as n,m as Q,o as V,i as c,g as u,s as r,n as M,t as A,e as R,p as k,q as $,j as U}from"./index-CYB56wGJ.js";import"./FileSaver.min-BCxzAtLx.js";const W={class:"articulos"},Y={class:"actions"},Z={class:"articulos-card"},ee={key:0},oe={key:1},le={class:"modal-content"},ae={class:"modal-title"},ie={class:"form-grid"},se={class:"form-row"},te={class:"form-col"},de={class:"form-group"},re={class:"form-group"},ue={key:0,class:"error-text"},ne={class:"form-group"},ce={key:0,class:"error-text"},pe={class:"form-group"},me={class:"form-group"},ve={class:"form-col"},fe={class:"form-group"},be={class:"form-group"},ge={class:"form-group"},Ve={class:"form-group"},Ae={class:"form-group"},Ce={class:"form-group"},Se={class:"modal-actions"},we={class:"dialog-content"},ke={class:"modal-actions"},Ue={class:"dialog-content"},ye={class:"modal-actions"},_e={__name:"Articulos",setup(Ne){const y=d([]),_=d([]),S=d(!0),p=d(!1),a=d({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:"",precioCompra:"",codigoSat:"",unidadSat:"",codigoUnidadSat:""}),m=d(""),h=d("nombre"),D=d(1),v=d(!1),C=d(""),b=d(!1),N=d(null),w=async()=>{S.value=!0;try{y.value=await j(),_.value=await Q()}finally{S.value=!1}};J(w);const E=x(()=>{const t={};return _.value.forEach(e=>{t[e.articulo_nombre]||(t[e.articulo_nombre]=[]),t[e.articulo_nombre].push(e)}),y.value.map(e=>{const f=(t[e.nombre]||[]).filter(K=>K.status==="Disponible").length;return Number(e.precioVenta),{...e,existencias:f}})}),T=t=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(t)||0),L=x(()=>m.value?E.value.filter(t=>{var e,o,f;return((e=t.nombre)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase()))||((o=t.sku)==null?void 0:o.toLowerCase().includes(m.value.toLowerCase()))||((f=t.descripcion)==null?void 0:f.toLowerCase().includes(m.value.toLowerCase()))}):E.value),I=()=>{a.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},p.value=!0},B=()=>{p.value=!1},O=async()=>{if(!a.value.nombre||!a.value.sku){C.value="Por favor, complete los campos obligatorios.",v.value=!0;return}try{const t={...a.value,codigo:a.value.codigo??"",pagina:a.value.pagina??""};a.value.id?await q(t):await z(t),p.value=!1,await w()}catch{C.value="Error al guardar el artículo.",v.value=!0}},P=t=>{a.value={...t},p.value=!0},F=t=>{N.value=t,b.value=!0},X=async t=>{try{await G(t),await w(),b.value=!1}catch{C.value="Error al eliminar el artículo.",v.value=!0}};return(t,e)=>(V(),g("div",W,[e[30]||(e[30]=l("h2",null,"Artículos",-1)),l("div",Y,[i(s(c),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:I}),i(s(u),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),l("div",Z,[i(s(R),{value:L.value,sortField:h.value,sortOrder:D.value,responsiveLayout:"scroll",loading:S.value},{default:n(()=>[i(s(r),{field:"sku",header:"SKU",sortable:""}),i(s(r),{field:"nombre",header:"Nombre",sortable:""}),i(s(r),{field:"tipo",header:"Tipo",sortable:""}),i(s(r),{field:"precioVenta",header:"Precio de venta"},{body:n(o=>[M(A(T(o.data.precioVenta)),1)]),_:1}),i(s(r),{header:"Existencias en mano"},{body:n(o=>[o.data.tipo&&o.data.tipo.toLowerCase()==="servicio"?(V(),g("span",ee,"NA")):(V(),g("span",oe,A(o.data.existencias),1))]),_:1}),i(s(r),{field:"precioCompra",header:"Precio de compra"},{body:n(o=>[M(A(T(o.data.precioCompra)),1)]),_:1}),i(s(r),{field:"codigoSat",header:"Código SAT",sortable:""}),i(s(r),{field:"unidadSat",header:"Unidad SAT",sortable:""}),i(s(r),{field:"codigoUnidadSat",header:"Código unidad SAT",sortable:""}),i(s(r),{header:"Acciones"},{body:n(o=>[i(s(c),{icon:"pi pi-pencil",class:"p-button-text",onClick:f=>P(o.data)},null,8,["onClick"]),i(s(c),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:f=>F(o.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),i(s(U),{visible:p.value,"onUpdate:visible":e[12]||(e[12]=o=>p.value=o),header:a.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:n(()=>[l("div",le,[l("h3",ae,A(a.value.id?"Editar Artículo":"Nuevo Artículo"),1),l("div",ie,[l("div",se,[l("div",te,[l("div",de,[e[18]||(e[18]=l("label",{for:"tipo"},"Tipo:",-1)),i(s(k),{id:"tipo",modelValue:a.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.tipo=o),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),l("div",re,[e[19]||(e[19]=l("label",{for:"nombre"},"Nombre:",-1)),i(s(u),{id:"nombre",modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.nombre=o),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),a.value.nombre?$("",!0):(V(),g("small",ue,"Obligatorio."))]),l("div",ne,[e[20]||(e[20]=l("label",{for:"sku"},"SKU:",-1)),i(s(u),{id:"sku",modelValue:a.value.sku,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.sku=o),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),a.value.sku?$("",!0):(V(),g("small",ce,"Obligatorio."))]),l("div",pe,[e[21]||(e[21]=l("label",{for:"unidad"},"Unidad:",-1)),i(s(k),{id:"unidad",modelValue:a.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.unidad=o),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])]),l("div",me,[e[22]||(e[22]=l("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),i(s(u),{id:"precioVenta",modelValue:a.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.precioVenta=o),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])])]),l("div",ve,[l("div",fe,[e[23]||(e[23]=l("label",{for:"impuesto"},"Impuesto:",-1)),i(s(k),{id:"impuesto",modelValue:a.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.impuesto=o),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),l("div",be,[e[24]||(e[24]=l("label",{for:"descripcion"},"Descripción:",-1)),i(s(u),{id:"descripcion",modelValue:a.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.descripcion=o),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])]),l("div",ge,[e[25]||(e[25]=l("label",{for:"precioCompra"},"Precio de compra (MXN):",-1)),i(s(u),{id:"precioCompra",modelValue:a.value.precioCompra,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.precioCompra=o),placeholder:"Precio de compra",class:"w-full"},null,8,["modelValue"])]),l("div",Ve,[e[26]||(e[26]=l("label",{for:"codigoSat"},"Código artículo SAT:",-1)),i(s(u),{id:"codigoSat",modelValue:a.value.codigoSat,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.codigoSat=o),placeholder:"Código SAT",class:"w-full"},null,8,["modelValue"])]),l("div",Ae,[e[27]||(e[27]=l("label",{for:"unidadSat"},"Unidad SAT:",-1)),i(s(u),{id:"unidadSat",modelValue:a.value.unidadSat,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.unidadSat=o),placeholder:"Unidad SAT",class:"w-full"},null,8,["modelValue"])]),l("div",Ce,[e[28]||(e[28]=l("label",{for:"codigoUnidadSat"},"Código unidad SAT:",-1)),i(s(u),{id:"codigoUnidadSat",modelValue:a.value.codigoUnidadSat,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.codigoUnidadSat=o),placeholder:"Código unidad SAT",class:"w-full"},null,8,["modelValue"])])])])]),l("div",Se,[i(s(c),{label:"Guardar",icon:"pi pi-save",onClick:O}),i(s(c),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:B})])])]),_:1},8,["visible","header"]),i(s(U),{visible:v.value,"onUpdate:visible":e[14]||(e[14]=o=>v.value=o),header:"Error",modal:!0,closable:!1},{default:n(()=>[l("div",we,[l("p",null,A(C.value),1),l("div",ke,[i(s(c),{label:"Aceptar",icon:"pi pi-check",onClick:e[13]||(e[13]=o=>v.value=!1)})])])]),_:1},8,["visible"]),i(s(U),{visible:b.value,"onUpdate:visible":e[17]||(e[17]=o=>b.value=o),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:n(()=>[l("div",Ue,[e[29]||(e[29]=l("p",null,"¿Eliminar este artículo?",-1)),l("div",ye,[i(s(c),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[15]||(e[15]=o=>X(N.value))}),i(s(c),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[16]||(e[16]=o=>b.value=!1)})])])]),_:1},8,["visible"])]))}},Me=H(_e,[["__scopeId","data-v-e0469476"]]);export{Me as default};
