import{u as R}from"./useVentas-D1DXrjSX.js";import{_ as T,r as A,c as n,a as i,b as l,d as e,w as u,t as r,ah as j,o,q as h,g as k,s as c,v as _,p as w,i as p,J as C,K as I,e as q,j as J}from"./index-CUS9nlnQ.js";import"./clientesService-HEFz_eIw.js";const K={class:"ventas-container"},O={class:"ventas-card"},z={class:"ventas-form-header"},H={class:"ventas-form-col"},Q={class:"ventas-form-col"},W={key:0},X={key:1},Y={key:0,class:"error-text"},Z={class:"imei-cell"},P={key:0},aa={key:0},ea={class:"imei-value"},ta={class:"mb-2"},la={class:"mb-2 acciones-footer"},ia={__name:"Ventas",setup(da){const{today:S,clientes:U,articulosDisponibles:$,ventas:na,ventaSeleccionada:oa,detalleVenta:sa,imeis:ua,showDialog:m,venta:s,totalVenta:x,articulosConStock:V,getStockDisponible:b,imeisDisponiblesPorArticulo:L,mostrarColumnaIMEI:N,addArticulo:D,removeArticulo:M,validateCantidad:E,onArticuloChange:F,guardarVenta:B,cargarDetalleVenta:ra}=R();A(!1);const f=A(!1),v=g=>{const t=$.value.find(a=>a.id===g);return t&&t.tipo&&t.tipo.toLowerCase()==="servicio"};async function G(){console.log("Guardando venta:",s),f.value=!0;try{await B()}finally{f.value=!1}}return(g,t)=>(o(),n("div",K,[t[10]||(t[10]=i("h2",{class:"ventas-title"},"Registrar Nota de Venta",-1)),i("div",O,[i("div",z,[i("div",H,[t[5]||(t[5]=i("label",{class:"mb-2"},"Cliente",-1)),l(e(h),{modelValue:e(s).cliente_id,"onUpdate:modelValue":t[0]||(t[0]=a=>e(s).cliente_id=a),options:e(U),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full"},null,8,["modelValue","options"])]),i("div",Q,[t[6]||(t[6]=i("label",null,"Fecha",-1)),l(e(k),{modelValue:e(s).fecha,"onUpdate:modelValue":t[1]||(t[1]=a=>e(s).fecha=a),value:e(S),readonly:"",class:"fecha-input"},null,8,["modelValue","value"])])]),t[9]||(t[9]=i("h3",null,"Artículos",-1)),l(e(q),{value:e(s).articulos,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[l(e(c),{header:"Artículo"},{body:u(a=>[l(e(h),{modelValue:a.data.articulo_id,"onUpdate:modelValue":d=>a.data.articulo_id=d,options:e(V)(a.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:d=>e(F)(a.data.articulo_id,a.data),disabled:e(V)(a.data).length===0},null,8,["modelValue","onUpdate:modelValue","options","onChange","disabled"])]),_:1}),l(e(c),{header:"Stock"},{body:u(a=>[v(a.data.articulo_id)?(o(),n("span",W,"NA")):(o(),n("span",X,r(e(b)(a.data.articulo_id,a.data)),1))]),_:1}),l(e(c),{field:"cantidad",header:"Cantidad"},{body:u(a=>[l(e(k),{type:"number",modelValue:a.data.cantidad,"onUpdate:modelValue":d=>a.data.cantidad=d,modelModifiers:{number:!0},min:1,max:v(a.data.articulo_id)?null:e(b)(a.data.articulo_id,a.data),class:"w-full",disabled:!a.data.articulo_id,onInput:d=>e(E)(a.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"]),!v(a.data.articulo_id)&&a.data.cantidad>e(b)(a.data.articulo_id,a.data)?(o(),n("small",Y," Máx: "+r(e(b)(a.data.articulo_id,a.data)),1)):_("",!0)]),_:1}),l(e(c),{field:"precio_unitario",header:"Precio"},{body:u(a=>[i("span",null,r(a.data.precio_unitario.toFixed(2)),1)]),_:1}),l(e(c),{field:"subtotal",header:"Subtotal"},{body:u(a=>[w(r((a.data.cantidad*a.data.precio_unitario).toFixed(2)),1)]),_:1}),l(e(c),{header:"Acciones"},{body:u(a=>[l(e(p),{icon:"pi pi-trash",class:"p-button-danger p-button-sm",onClick:d=>e(M)(a.index)},null,8,["onClick"])]),_:1}),l(e(c),{header:"IMEI"},{body:u(a=>[i("div",Z,[v(a.data.articulo_id)?(o(),n("span",P,"NA")):e(N)(a.data.articulo_id)?(o(),n(C,{key:1},[(o(!0),n(C,null,I(a.data.cantidad,d=>(o(),n("div",{key:d,style:{"margin-bottom":"0.2em"}},[l(e(h),{modelValue:a.data.imeis[d-1],"onUpdate:modelValue":y=>a.data.imeis[d-1]=y,options:e(L)(a.data.articulo_id,a.data,d-1),optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full imei-dropdown",disabled:!a.data.articulo_id,filter:""},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]))),128)),a.data.imeis&&a.data.imeis.length?(o(),n("div",aa,[g.imei?(o(!0),n(C,{key:0},I(a.data.imeis,(d,y)=>(o(),n("span",{key:d,class:"imei-seleccionado"},[w(" IMEI "+r(y+1)+": ",1),i("span",ea,r(d),1)]))),128)):_("",!0)])):_("",!0)],64)):_("",!0)])]),_:1})]),_:1},8,["value"]),l(e(p),{label:"Agregar Artículo",icon:"pi pi-plus",class:"mb-2",onClick:e(D),disabled:e(V)().length===0},null,8,["onClick","disabled"]),i("div",ta,[t[7]||(t[7]=i("label",null,"Observaciones",-1)),l(e(k),{modelValue:e(s).observaciones,"onUpdate:modelValue":t[2]||(t[2]=a=>e(s).observaciones=a),class:"w-full"},null,8,["modelValue"])]),i("div",la,[i("strong",null,"Total: $"+r(e(x).toFixed(2)),1),l(e(p),{label:"Guardar Venta",class:"mb-2",onClick:G,disabled:!e(s).cliente_id||e(s).articulos.length===0||f.value},null,8,["disabled"])]),l(e(J),{visible:e(m),"onUpdate:visible":t[4]||(t[4]=a=>j(m)?m.value=a:null),header:"Venta registrada",closable:!1,modal:!0,class:"ventas-dialog"},{default:u(()=>[t[8]||(t[8]=i("p",null,"La nota de venta se registró correctamente.",-1)),l(e(p),{label:"Aceptar",icon:"pi pi-check",onClick:t[3]||(t[3]=a=>m.value=!1),autofocus:""})]),_:1},8,["visible"])])]))}},va=T(ia,[["__scopeId","data-v-ac7aa416"]]);export{va as default};
