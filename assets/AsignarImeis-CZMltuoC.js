import{_ as T,r as t,l as k,k as j,m as K,A as q,c as A,a as l,p as M,b as n,d as o,B as F,C as R,D as Y,w as f,v as _,E as z,F as G,n as C,G as U,H,o as h,q as V,g as W,t as y,s as x,I as J,i as w,e as P,j as D}from"./index-cm-GLTEx.js";const Q={class:"asignar-imeis-container"},X={class:"form-card"},Z={class:"form-group"},ee={class:"form-group"},ae={class:"form-group"},le={class:"form-group"},se={key:0,class:"form-group"},ie={class:"form-actions"},oe={class:"dialog-actions"},te={style:{"white-space":"pre-line"}},ne={class:"dialog-actions"},ue={__name:"AsignarImeis",setup(re){const $=t([]),p=t(null),I=t(""),s=t([]),c=t(""),d=t(!1),m=t(!1),E=t(""),b=t([]),g=t([]),u=t(null),v=t(!1),r=t(null),O=k(()=>$.value.filter(i=>i.tipo&&i.tipo.toLowerCase()!=="servicio")),L=k(()=>!v.value||!r.value?g.value:g.value.filter(i=>i.id!==r.value.id));j(async()=>{$.value=await K(),g.value=await q(),u.value=g.value[0]||null,r.value=g.value[0]||null});const B=()=>{const i=I.value.trim();if(i){if(s.value.includes(i)){E.value=`El IMEI "${i}" ya está en la lista.`,m.value=!0,I.value="";return}s.value.push(i),I.value=""}},N=i=>{s.value.splice(i,1)},S=async()=>{if(!(!p.value||s.value.length===0||!u.value)){if(v.value&&r.value&&u.value&&r.value.id===u.value.id){E.value="La ubicación origen y destino no pueden ser la misma.",m.value=!0;return}try{const i=await C(),e=new Set(i.map(a=>a.imei));b.value=s.value.filter(a=>e.has(a))}catch{c.value="Error al validar IMEIs existentes en la base de datos.",d.value=!0;return}if(v.value){if((await C()).filter(a=>s.value.includes(a.imei)&&a.ubicacion_id===r.value.id).length!==s.value.length){E.value="Todos los IMEIs deben existir y estar en la ubicación origen para transferir.",m.value=!0;return}try{await U(u.value.id,s.value,r.value.id),c.value=`${s.value.length} IMEIs transferidos de "${r.value.nombre}" a "${u.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{c.value="Ocurrió un error al transferir los IMEIs."}d.value=!0;return}if(b.value.length>0){c.value=`Los siguientes IMEIs ya están registrados en el sistema:
${b.value.join(`
`)}
Elimínalos de la lista para continuar.`,d.value=!0;return}try{await H(p.value.nombre,s.value),await U(u.value.id,s.value),c.value=`${s.value.length} IMEIs asignados al artículo "${p.value.nombre}" y a la ubicación "${u.value.nombre}" correctamente.`,s.value=[],b.value=[]}catch{c.value="Ocurrió un error al asignar los IMEIs."}d.value=!0}};return(i,e)=>(h(),A("div",Q,[e[14]||(e[14]=l("h2",null,"Asignar IMEIs a Artículo",-1)),l("div",X,[l("div",Z,[e[9]||(e[9]=l("label",{for:"articulo"},[M(" Artículo "),l("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),n(o(V),{id:"articulo",modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=a=>p.value=a),options:O.value,optionLabel:"nombre",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),l("div",ee,[e[10]||(e[10]=l("label",{for:"nuevoImei"},"IMEI:",-1)),n(o(W),{id:"nuevoImei",modelValue:I.value,"onUpdate:modelValue":e[1]||(e[1]=a=>I.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!p.value,onKeydown:F(R(B,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),s.value.length?(h(),Y(o(P),{key:0,value:s.value,class:"imeis-table",rows:5,paginator:s.value.length>5,responsiveLayout:"scroll",emptyMessage:"No hay IMEIs agregados."},{default:f(()=>[n(o(x),{header:"#",style:{width:"50px"}},{body:f(a=>[M(y(a.index+1),1)]),_:1}),n(o(x),{header:"IMEI"},{body:f(a=>[l("span",{class:J({"imei-existente":b.value.includes(a.data)})},y(a.data),3)]),_:1}),n(o(x),{header:"Eliminar",style:{width:"70px"}},{body:f(a=>[n(o(w),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:ce=>N(a.index)},null,8,["onClick"])]),_:1})]),_:1},8,["value","paginator"])):_("",!0)]),l("div",ae,[e[11]||(e[11]=l("label",{for:"ubicacionDestino"}," Ubicación destino ",-1)),n(o(V),{disabled:!v.value,id:"ubicacionDestino",modelValue:u.value,"onUpdate:modelValue":e[2]||(e[2]=a=>u.value=a),options:L.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["disabled","modelValue","options"])]),l("div",le,[l("label",null,[z(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>v.value=a)},null,512),[[G,v.value]]),e[12]||(e[12]=M(" Transferencia entre ubicaciones "))])]),v.value?(h(),A("div",se,[e[13]||(e[13]=l("label",{for:"ubicacionOrigen"},"Ubicación origen",-1)),n(o(V),{id:"ubicacionOrigen",modelValue:r.value,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value=a),options:g.value,optionLabel:"nombre",placeholder:"Selecciona ubicación origen",class:"w-full"},null,8,["modelValue","options"])])):_("",!0),l("div",ie,[n(o(w),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:S,class:"p-button-success",disabled:s.value.length===0},null,8,["disabled"])])]),n(o(D),{visible:d.value,"onUpdate:visible":e[6]||(e[6]=a=>d.value=a),header:"Resultado",modal:!0,closable:!1},{default:f(()=>[l("p",null,y(c.value),1),l("div",oe,[n(o(w),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>d.value=!1),autofocus:""})])]),_:1},8,["visible"]),n(o(D),{visible:m.value,"onUpdate:visible":e[8]||(e[8]=a=>m.value=a),header:"Advertencia",modal:!0,closable:!1},{default:f(()=>[l("p",te,y(E.value),1),l("div",ne,[n(o(w),{label:"Aceptar",icon:"pi pi-check",onClick:e[7]||(e[7]=a=>m.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},ve=T(ue,[["__scopeId","data-v-9cb587b6"]]);export{ve as default};
