import{g as j,u as q,a as z,d as G}from"./articulosService-DZjvDTAh.js";import{_ as H,r,k as J,l as M,c as S,a as l,b as i,d as s,w as n,m as Q,o as w,i as c,g as u,s as d,n as U,t as g,e as R,p as k,q as $,j as y}from"./index-BypK6ZTZ.js";import"./FileSaver.min-BCxzAtLx.js";const W={class:"articulos"},Y={class:"actions"},Z={class:"articulos-card"},ee={class:"modal-content"},oe={class:"modal-title"},le={class:"form-grid"},ae={class:"form-row"},ie={class:"form-col"},se={class:"form-group"},te={class:"form-group"},re={key:0,class:"error-text"},de={class:"form-group"},ue={key:0,class:"error-text"},ne={class:"form-group"},ce={class:"form-group"},pe={class:"form-col"},me={class:"form-group"},ve={class:"form-group"},fe={class:"form-group"},be={class:"form-group"},ge={class:"form-group"},Ve={class:"form-group"},Ae={class:"modal-actions"},Ce={class:"dialog-content"},Se={class:"modal-actions"},we={class:"dialog-content"},Ue={class:"modal-actions"},ke={__name:"Articulos",setup(ye){const _=r([]),N=r([]),A=r(!0),p=r(!1),a=r({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:"",precioCompra:"",codigoSat:"",unidadSat:"",codigoUnidadSat:""}),m=r(""),D=r("nombre"),h=r(1),v=r(!1),V=r(""),b=r(!1),E=r(null),C=async()=>{A.value=!0;try{_.value=await j(),N.value=await Q()}finally{A.value=!1}};J(C);const T=M(()=>{const t={};return N.value.forEach(e=>{t[e.articulo_nombre]||(t[e.articulo_nombre]=[]),t[e.articulo_nombre].push(e)}),_.value.map(e=>{const f=(t[e.nombre]||[]).filter(K=>K.status==="Disponible").length;return Number(e.precioVenta),{...e,existencias:f}})}),x=t=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(t)||0),I=M(()=>m.value?T.value.filter(t=>{var e,o,f;return((e=t.nombre)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase()))||((o=t.sku)==null?void 0:o.toLowerCase().includes(m.value.toLowerCase()))||((f=t.descripcion)==null?void 0:f.toLowerCase().includes(m.value.toLowerCase()))}):T.value),L=()=>{a.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},p.value=!0},P=()=>{p.value=!1},B=async()=>{if(!a.value.nombre||!a.value.sku){V.value="Por favor, complete los campos obligatorios.",v.value=!0;return}try{const t={...a.value,codigo:a.value.codigo??"",pagina:a.value.pagina??""};a.value.id?await q(t):await z(t),p.value=!1,await C()}catch{V.value="Error al guardar el artículo.",v.value=!0}},O=t=>{a.value={...t},p.value=!0},F=t=>{E.value=t,b.value=!0},X=async t=>{try{await G(t),await C(),b.value=!1}catch{V.value="Error al eliminar el artículo.",v.value=!0}};return(t,e)=>(w(),S("div",W,[e[30]||(e[30]=l("h2",null,"Artículos",-1)),l("div",Y,[i(s(c),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:L}),i(s(u),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),l("div",Z,[i(s(R),{value:I.value,sortField:D.value,sortOrder:h.value,responsiveLayout:"scroll",loading:A.value},{default:n(()=>[i(s(d),{field:"sku",header:"SKU",sortable:""}),i(s(d),{field:"nombre",header:"Nombre",sortable:""}),i(s(d),{field:"tipo",header:"Tipo",sortable:""}),i(s(d),{field:"precioVenta",header:"Precio de venta"},{body:n(o=>[U(g(x(o.data.precioVenta)),1)]),_:1}),i(s(d),{header:"Existencias en mano"},{body:n(o=>[U(g(o.data.existencias),1)]),_:1}),i(s(d),{field:"precioCompra",header:"Precio de compra"},{body:n(o=>[U(g(x(o.data.precioCompra)),1)]),_:1}),i(s(d),{field:"codigoSat",header:"Código SAT",sortable:""}),i(s(d),{field:"unidadSat",header:"Unidad SAT",sortable:""}),i(s(d),{field:"codigoUnidadSat",header:"Código unidad SAT",sortable:""}),i(s(d),{header:"Acciones"},{body:n(o=>[i(s(c),{icon:"pi pi-pencil",class:"p-button-text",onClick:f=>O(o.data)},null,8,["onClick"]),i(s(c),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:f=>F(o.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),i(s(y),{visible:p.value,"onUpdate:visible":e[12]||(e[12]=o=>p.value=o),header:a.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:n(()=>[l("div",ee,[l("h3",oe,g(a.value.id?"Editar Artículo":"Nuevo Artículo"),1),l("div",le,[l("div",ae,[l("div",ie,[l("div",se,[e[18]||(e[18]=l("label",{for:"tipo"},"Tipo:",-1)),i(s(k),{id:"tipo",modelValue:a.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=o=>a.value.tipo=o),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),l("div",te,[e[19]||(e[19]=l("label",{for:"nombre"},"Nombre:",-1)),i(s(u),{id:"nombre",modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.nombre=o),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),a.value.nombre?$("",!0):(w(),S("small",re,"Obligatorio."))]),l("div",de,[e[20]||(e[20]=l("label",{for:"sku"},"SKU:",-1)),i(s(u),{id:"sku",modelValue:a.value.sku,"onUpdate:modelValue":e[3]||(e[3]=o=>a.value.sku=o),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),a.value.sku?$("",!0):(w(),S("small",ue,"Obligatorio."))]),l("div",ne,[e[21]||(e[21]=l("label",{for:"unidad"},"Unidad:",-1)),i(s(k),{id:"unidad",modelValue:a.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=o=>a.value.unidad=o),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])]),l("div",ce,[e[22]||(e[22]=l("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),i(s(u),{id:"precioVenta",modelValue:a.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=o=>a.value.precioVenta=o),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])])]),l("div",pe,[l("div",me,[e[23]||(e[23]=l("label",{for:"impuesto"},"Impuesto:",-1)),i(s(k),{id:"impuesto",modelValue:a.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.impuesto=o),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),l("div",ve,[e[24]||(e[24]=l("label",{for:"descripcion"},"Descripción:",-1)),i(s(u),{id:"descripcion",modelValue:a.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.descripcion=o),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])]),l("div",fe,[e[25]||(e[25]=l("label",{for:"precioCompra"},"Precio de compra (MXN):",-1)),i(s(u),{id:"precioCompra",modelValue:a.value.precioCompra,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.precioCompra=o),placeholder:"Precio de compra",class:"w-full"},null,8,["modelValue"])]),l("div",be,[e[26]||(e[26]=l("label",{for:"codigoSat"},"Código artículo SAT:",-1)),i(s(u),{id:"codigoSat",modelValue:a.value.codigoSat,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.codigoSat=o),placeholder:"Código SAT",class:"w-full"},null,8,["modelValue"])]),l("div",ge,[e[27]||(e[27]=l("label",{for:"unidadSat"},"Unidad SAT:",-1)),i(s(u),{id:"unidadSat",modelValue:a.value.unidadSat,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.unidadSat=o),placeholder:"Unidad SAT",class:"w-full"},null,8,["modelValue"])]),l("div",Ve,[e[28]||(e[28]=l("label",{for:"codigoUnidadSat"},"Código unidad SAT:",-1)),i(s(u),{id:"codigoUnidadSat",modelValue:a.value.codigoUnidadSat,"onUpdate:modelValue":e[11]||(e[11]=o=>a.value.codigoUnidadSat=o),placeholder:"Código unidad SAT",class:"w-full"},null,8,["modelValue"])])])])]),l("div",Ae,[i(s(c),{label:"Guardar",icon:"pi pi-save",onClick:B}),i(s(c),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:P})])])]),_:1},8,["visible","header"]),i(s(y),{visible:v.value,"onUpdate:visible":e[14]||(e[14]=o=>v.value=o),header:"Error",modal:!0,closable:!1},{default:n(()=>[l("div",Ce,[l("p",null,g(V.value),1),l("div",Se,[i(s(c),{label:"Aceptar",icon:"pi pi-check",onClick:e[13]||(e[13]=o=>v.value=!1)})])])]),_:1},8,["visible"]),i(s(y),{visible:b.value,"onUpdate:visible":e[17]||(e[17]=o=>b.value=o),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:n(()=>[l("div",we,[e[29]||(e[29]=l("p",null,"¿Eliminar este artículo?",-1)),l("div",Ue,[i(s(c),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[15]||(e[15]=o=>X(E.value))}),i(s(c),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[16]||(e[16]=o=>b.value=!1)})])])]),_:1},8,["visible"])]))}},Te=H(ke,[["__scopeId","data-v-6279f7ae"]]);export{Te as default};
