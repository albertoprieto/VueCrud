import{_ as B,r as s,k as L,c as b,a as l,n as y,b as n,d as t,v as N,x as O,F as S,y as T,q as U,z as j,A as K,w as $,m as q,B as z,o as g,p as V,g as F,C as R,t as M,i as I,j as h}from"./index-BypK6ZTZ.js";import{g as Y}from"./articulosService-DZjvDTAh.js";import{g as P,a as W}from"./ubicacionesService-g8Nyy4A9.js";const G={class:"asignar-imeis-container"},H={class:"form-card"},J={class:"form-group"},Q={class:"form-group"},X={key:0,class:"imeis-list"},Z={class:"form-group"},ee={class:"form-group"},ae={key:0,class:"form-group"},le={class:"form-actions"},se={class:"dialog-actions"},ie={style:{"white-space":"pre-line"}},oe={class:"dialog-actions"},ne={__name:"AsignarImeis",setup(te){const k=s([]),u=s(null),d=s(""),i=s([]),v=s(""),r=s(!1),f=s(!1),A=s(""),p=s([]),m=s([]),c=s(null),w=s(!1),E=s(null);L(async()=>{k.value=await Y(),m.value=await P(),c.value=m.value[0]||null,E.value=m.value[0]||null});const C=()=>{const o=d.value.trim();if(o){if(i.value.includes(o)){A.value=`El IMEI "${o}" ya está en la lista.`,f.value=!0,d.value="";return}i.value.push(o),d.value=""}},_=o=>{i.value.splice(o,1)},D=async()=>{if(!(!u.value||i.value.length===0||!c.value)){try{const o=await q(),e=new Set(o.map(a=>a.imei));p.value=i.value.filter(a=>e.has(a))}catch{v.value="Error al validar IMEIs existentes en la base de datos.",r.value=!0;return}if(p.value.length>0){v.value=`Los siguientes IMEIs ya están registrados en el sistema:
${p.value.join(`
`)}
Elimínalos de la lista para continuar.`,r.value=!0;return}try{await z(u.value.nombre,i.value),await W(c.value.id,i.value),v.value=`${i.value.length} IMEIs asignados al artículo "${u.value.nombre}" y a la ubicación "${c.value.nombre}" correctamente.`,i.value=[],p.value=[]}catch{v.value="Ocurrió un error al asignar los IMEIs."}r.value=!0}};return(o,e)=>(g(),b("div",G,[e[14]||(e[14]=l("h2",null,"Asignar IMEIs a Artículo",-1)),l("div",H,[l("div",J,[e[9]||(e[9]=l("label",{for:"articulo"},[y(" Artículo "),l("span",{class:"required-tooltip",title:"Obligatorio"},"*")],-1)),n(t(V),{id:"articulo",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=a=>u.value=a),options:k.value,optionLabel:"nombre",placeholder:"Selecciona artículo",class:"w-full"},null,8,["modelValue","options"])]),l("div",Q,[e[10]||(e[10]=l("label",{for:"nuevoImei"},"IMEI:",-1)),n(t(F),{id:"nuevoImei",modelValue:d.value,"onUpdate:modelValue":e[1]||(e[1]=a=>d.value=a),placeholder:"Escanea o escribe un IMEI y presiona Enter",class:"w-full",disabled:!u.value,onKeydown:N(O(C,["prevent"]),["enter"])},null,8,["modelValue","disabled","onKeydown"]),i.value.length?(g(),b("ul",X,[(g(!0),b(S,null,T(i.value,(a,x)=>(g(),b("li",{key:x,class:R({"imei-existente":p.value.includes(a)})},[y(M(a)+" ",1),n(t(I),{icon:"pi pi-times",class:"p-button-text p-button-danger",onClick:ue=>_(x)},null,8,["onClick"])],2))),128))])):U("",!0)]),l("div",Z,[e[11]||(e[11]=l("label",{for:"ubicacionDestino"}," Ubicación destino ",-1)),n(t(V),{id:"ubicacionDestino",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=a=>c.value=a),options:m.value,optionLabel:"nombre",placeholder:"Selecciona ubicación",class:"w-full"},null,8,["modelValue","options"])]),l("div",ee,[l("label",null,[j(l("input",{type:"checkbox","onUpdate:modelValue":e[3]||(e[3]=a=>w.value=a)},null,512),[[K,w.value]]),e[12]||(e[12]=y(" Transferencia entre ubicaciones "))])]),w.value?(g(),b("div",ae,[e[13]||(e[13]=l("label",{for:"ubicacionOrigen"},"Ubicación origen",-1)),n(t(V),{id:"ubicacionOrigen",modelValue:E.value,"onUpdate:modelValue":e[4]||(e[4]=a=>E.value=a),options:m.value,optionLabel:"nombre",placeholder:"Selecciona ubicación origen",class:"w-full"},null,8,["modelValue","options"])])):U("",!0),l("div",le,[n(t(I),{label:"Registrar y asignar IMEIs",icon:"pi pi-save",onClick:D,class:"p-button-success",disabled:i.value.length===0},null,8,["disabled"])])]),n(t(h),{visible:r.value,"onUpdate:visible":e[6]||(e[6]=a=>r.value=a),header:"Resultado",modal:!0,closable:!1},{default:$(()=>[l("p",null,M(v.value),1),l("div",se,[n(t(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[5]||(e[5]=a=>r.value=!1),autofocus:""})])]),_:1},8,["visible"]),n(t(h),{visible:f.value,"onUpdate:visible":e[8]||(e[8]=a=>f.value=a),header:"Advertencia",modal:!0,closable:!1},{default:$(()=>[l("p",ie,M(A.value),1),l("div",oe,[n(t(I),{label:"Aceptar",icon:"pi pi-check",onClick:e[7]||(e[7]=a=>f.value=!1),autofocus:""})])]),_:1},8,["visible"])]))}},ve=B(ne,[["__scopeId","data-v-a144818d"]]);export{ve as default};
