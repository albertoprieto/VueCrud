import{u as A}from"./useVentas-BnNeFjwi.js";import{_ as J,r as _,ag as j,o as p,D as L,w as u,a as t,b as i,d as l,q as x,g as $,s as b,e as T,i as g,j as B,l as K,c as V,v as O,p as S,t as c,J as X,K as q}from"./index-d7sXuZmh.js";import"./clientesService-DVqbXDqc.js";const z={class:"ventas-form-header"},G={class:"ventas-form-col"},H={class:"ventas-form-col"},Q={class:"mb-2"},R={class:"modal-actions"},W={__name:"EditarVenta",props:{venta:Object,clientes:Array},emits:["cerrar","guardar"],setup(E,{emit:N}){const v=E,r=N,{articulosConStock:y,getStockDisponible:C,imeisDisponiblesPorArticulo:h,mostrarColumnaIMEI:m,validateCantidad:k,onArticuloChange:U}=A(),f=_(!0);function w(n){return n?/^\d{4}-\d{2}-\d{2}$/.test(n)?n:typeof n=="string"&&(n.includes(" ")||n.includes("T"))?n.split(/[ T]/)[0]:n instanceof Date?n.toISOString().slice(0,10):n:""}const d=_({...v.venta,fecha:w(v.venta.fecha),detalle:v.venta.detalle?JSON.parse(JSON.stringify(v.venta.detalle)):[]});console.log("Fecha inicial recibida:",v.venta.fecha),console.log("ventaEdit inicial:",d.value),j(()=>v.venta,n=>{console.log("Prop venta actualizada:",n),d.value={...n,fecha:w(n.fecha),detalle:n.detalle?JSON.parse(JSON.stringify(n.detalle)):[]},console.log("ventaEdit después de update:",d.value)});function D(){r("guardar",{...d.value}),I()}function I(){f.value=!1,r("cerrar")}return(n,a)=>(p(),L(l(B),{visible:f.value,"onUpdate:visible":a[3]||(a[3]=e=>f.value=e),header:"Editar Nota de Venta",modal:!0,class:"ventas-dialog"},{default:u(()=>[t("div",z,[t("div",G,[a[4]||(a[4]=t("label",{class:"mb-2"},"Cliente",-1)),i(l(x),{modelValue:d.value.cliente_id,"onUpdate:modelValue":a[0]||(a[0]=e=>d.value.cliente_id=e),options:E.clientes,optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full",disabled:""},null,8,["modelValue","options"])]),t("div",H,[a[5]||(a[5]=t("label",null,"Fecha",-1)),i(l($),{modelValue:d.value.fecha,"onUpdate:modelValue":a[1]||(a[1]=e=>d.value.fecha=e),type:"date",class:"fecha-input"},null,8,["modelValue"])])]),t("div",Q,[a[6]||(a[6]=t("label",null,"Observaciones",-1)),i(l($),{modelValue:d.value.observaciones,"onUpdate:modelValue":a[2]||(a[2]=e=>d.value.observaciones=e),class:"w-full"},null,8,["modelValue"])]),a[7]||(a[7]=t("h3",null,"Artículos",-1)),i(l(T),{value:d.value.detalle,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[i(l(b),{header:"Artículo"},{body:u(e=>[i(l(x),{modelValue:e.data.articulo_id,"onUpdate:modelValue":o=>e.data.articulo_id=o,options:l(y)(e.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:o=>l(U)(e.data.articulo_id,e.data),disabled:!0},null,8,["modelValue","onUpdate:modelValue","options","onChange"])]),_:1}),i(l(b),{header:"Cantidad"},{body:u(e=>[i(l($),{type:"number",modelValue:e.data.cantidad,"onUpdate:modelValue":o=>e.data.cantidad=o,modelModifiers:{number:!0},min:1,max:l(m)(e.data.articulo_id)?1:l(C)(e.data.articulo_id,e.data),class:"w-full",disabled:l(m)(e.data.articulo_id),onInput:o=>l(k)(e.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"])]),_:1}),i(l(b),{header:"Precio"},{body:u(e=>[i(l($),{type:"number",modelValue:e.data.precio_unitario,"onUpdate:modelValue":o=>e.data.precio_unitario=o,modelModifiers:{number:!0},min:"0",step:"0.01",class:"w-full"},null,8,["modelValue","onUpdate:modelValue"])]),_:1}),i(l(b),{header:"IMEI"},{body:u(e=>[i(l(x),{modelValue:e.data.imei,"onUpdate:modelValue":o=>e.data.imei=o,options:[...l(h)(e.data.articulo_id,e.data)||[],...e.data.imei?[{imei:e.data.imei}]:[]],optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full",disabled:!e.data.articulo_id},null,8,["modelValue","onUpdate:modelValue","options","disabled"])]),_:1})]),_:1},8,["value"]),t("div",R,[i(l(g),{label:"Guardar",icon:"pi pi-save",onClick:D}),i(l(g),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:I})])]),_:1},8,["visible"]))}},Y=J(W,[["__scopeId","data-v-99431755"]]),Z={class:"consultar-ventas"},P={class:"filtros"},ee={key:0,class:"detalle-venta-dialog"},ae={class:"mb-2"},le={class:"detalle-table"},te={key:0},ne={key:0},ie={class:"detalle-venta-footer"},oe={class:"detalle-total"},de={key:1},se={__name:"consultarVentas",setup(E){const{ventas:N,cargarDetalleVenta:v,detalleVenta:r}=A(),y=_(""),C=_(!1),h=_(null),m=_(null),k=_(""),U=K(()=>y.value?N.value.filter(n=>{var a;return(a=n.cliente_nombre)==null?void 0:a.toLowerCase().includes(y.value.toLowerCase())}):N.value);function f(n){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(n)||0)}async function w(n){h.value=n,await v({data:n}),C.value=!0}async function d(n){await v({data:n}),m.value={...n,detalle:r.value?JSON.parse(JSON.stringify(r.value)):[]},k.value=n.fecha?n.fecha.split(/[ T]/)[0]:""}function D(){}function I(){m.value=null,k.value=""}return(n,a)=>(p(),V("div",Z,[a[11]||(a[11]=t("h2",null,"Consultar Notas de Venta",-1)),t("div",P,[i(l($),{modelValue:y.value,"onUpdate:modelValue":a[0]||(a[0]=e=>y.value=e),placeholder:"Filtrar por cliente...",class:"mb-2"},null,8,["modelValue"]),i(l(g),{label:"Buscar",icon:"pi pi-search",onClick:D,class:"mb-2"})]),i(l(T),{value:U.value},{default:u(()=>[i(l(b),{field:"id",header:"ID"}),i(l(b),{field:"cliente_nombre",header:"Cliente"}),i(l(b),{field:"fecha",header:"Fecha"},{body:u(e=>{var o;return[S(c(((o=e.data.fecha)==null?void 0:o.split(" ")[0])||""),1)]}),_:1}),i(l(b),{field:"total",header:"Total"},{body:u(e=>[S(c(f(e.data.total)),1)]),_:1}),i(l(b),{header:"Acciones"},{body:u(e=>[i(l(g),{label:"Editar",icon:"pi pi-pencil",class:"p-button-text",onClick:o=>d(e.data)},null,8,["onClick"]),i(l(g),{label:"Ver Detalle",icon:"pi pi-eye",class:"p-button-text",onClick:o=>w(e.data)},null,8,["onClick"])]),_:1})]),_:1},8,["value"]),i(l(B),{visible:C.value,"onUpdate:visible":a[2]||(a[2]=e=>C.value=e),header:"Detalle de Venta",modal:!0},{default:u(()=>{var e,o,F;return[l(r)&&l(r).length?(p(),V("div",ee,[t("div",ae,[a[3]||(a[3]=t("strong",null,"Fecha de nota:",-1)),S(" "+c(((o=(e=h.value)==null?void 0:e.fecha)==null?void 0:o.split(" ")[0])||"Sin fecha"),1)]),t("table",le,[t("thead",null,[t("tr",null,[a[4]||(a[4]=t("th",null,"Artículo",-1)),a[5]||(a[5]=t("th",null,"Cantidad",-1)),a[6]||(a[6]=t("th",null,"Precio",-1)),a[7]||(a[7]=t("th",null,"Subtotal",-1)),l(r).some(s=>s.imei)?(p(),V("th",te,"IMEI")):O("",!0)])]),t("tbody",null,[(p(!0),V(X,null,q(l(r),s=>(p(),V("tr",{key:s.id},[t("td",null,c(s.articulo_nombre),1),t("td",null,c(s.cantidad),1),t("td",null,c(f(s.precio_unitario)),1),t("td",null,c(f(s.cantidad*s.precio_unitario)),1),s.imei?(p(),V("td",ne,c(s.imei),1)):O("",!0)]))),128))])]),t("div",ie,[t("div",null,[a[8]||(a[8]=t("strong",null,"Observaciones:",-1)),S(" "+c(((F=h.value)==null?void 0:F.observaciones)||"Sin observaciones"),1)]),t("div",oe,[a[9]||(a[9]=t("strong",null,"Total:",-1)),S(" "+c(f(l(r).reduce((s,M)=>s+M.cantidad*M.precio_unitario,0))),1)])])])):(p(),V("div",de,a[10]||(a[10]=[t("span",null,"No hay detalle disponible.",-1)]))),i(l(g),{label:"Cerrar",onClick:a[1]||(a[1]=s=>C.value.value=!1),class:"detalle-cerrar-btn"})]}),_:1},8,["visible"]),m.value?(p(),L(Y,{venta:m.value,onCerrar:I,key:m.value?m.value.id+"-"+k.value:"empty"},null,8,["venta"])):O("",!0)]))}},ve=J(se,[["__scopeId","data-v-e09f21b2"]]);export{ve as default};
