import{u as G}from"./useVentas-Clni1dVQ.js";import{_ as J,r as K,c as o,a as t,b as i,d as e,w as u,t as s,L as A,o as n,q as C,g as h,s as r,v as b,p as x,i as m,J as w,D as z,e as D,K as H,j as U}from"./index-BZtuHe24.js";import"./clientesService-DRt112T4.js";const Q={class:"ventas-container"},W={class:"ventas-card"},X={class:"ventas-form-header"},Y={class:"ventas-form-col"},Z={class:"ventas-form-col"},P={key:0},ee={key:1},ae={key:0,class:"error-text"},le={key:1,class:"info-text"},te={class:"imei-cell"},ie={key:0},de={key:1,class:"imei-seleccionado"},ne={class:"imei-value"},oe={class:"mb-2"},se={class:"mb-2"},ue={key:0,class:"detalle-venta-dialog"},re={class:"detalle-table"},ce={key:0},ve={key:0},be={class:"detalle-venta-footer"},me={class:"detalle-total"},_e={key:1},pe={__name:"Ventas",setup(fe){const{today:F,clientes:M,articulosDisponibles:L,ventas:N,ventaSeleccionada:p,detalleVenta:_,imeis:Ve,showDialog:f,venta:c,totalVenta:E,articulosConStock:y,getStockDisponible:V,imeisDisponiblesPorArticulo:R,mostrarColumnaIMEI:k,addArticulo:B,removeArticulo:T,validateCantidad:q,onArticuloChange:O,guardarVenta:j,cargarDetalleVenta:I}=G(),g=K(!1),v=S=>{const l=L.value.find(a=>a.id===S);return l&&l.tipo&&l.tipo.toLowerCase()==="servicio"};return(S,l)=>(n(),o("div",Q,[l[22]||(l[22]=t("h2",{class:"ventas-title"},"Registrar Nota de Venta",-1)),t("div",W,[t("div",X,[t("div",Y,[l[8]||(l[8]=t("label",{class:"mb-2"},"Cliente",-1)),i(e(C),{modelValue:e(c).cliente_id,"onUpdate:modelValue":l[0]||(l[0]=a=>e(c).cliente_id=a),options:e(M),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona un cliente",class:"w-full"},null,8,["modelValue","options"])]),t("div",Z,[l[9]||(l[9]=t("label",null,"Fecha",-1)),i(e(h),{modelValue:e(c).fecha,"onUpdate:modelValue":l[1]||(l[1]=a=>e(c).fecha=a),value:e(F),readonly:"",class:"fecha-input"},null,8,["modelValue","value"])])]),l[20]||(l[20]=t("h3",null,"Artículos",-1)),i(e(D),{value:e(c).articulos,responsiveLayout:"scroll",class:"venta-articulos-table"},{default:u(()=>[i(e(r),{header:"Artículo"},{body:u(a=>[i(e(C),{modelValue:a.data.articulo_id,"onUpdate:modelValue":d=>a.data.articulo_id=d,options:e(y)(a.data),optionLabel:"nombre",optionValue:"id",placeholder:"Selecciona artículo",class:"w-full",onChange:d=>e(O)(a.data.articulo_id,a.data),disabled:e(y)(a.data).length===0},null,8,["modelValue","onUpdate:modelValue","options","onChange","disabled"])]),_:1}),i(e(r),{header:"Stock"},{body:u(a=>[v(a.data.articulo_id)?(n(),o("span",P,"NA")):(n(),o("span",ee,s(e(V)(a.data.articulo_id,a.data)),1))]),_:1}),i(e(r),{field:"cantidad",header:"Cantidad"},{body:u(a=>[i(e(h),{type:"number",modelValue:a.data.cantidad,"onUpdate:modelValue":d=>a.data.cantidad=d,modelModifiers:{number:!0},min:1,max:!v(a.data.articulo_id)&&e(k)(a.data.articulo_id)?1:v(a.data.articulo_id)?null:e(V)(a.data.articulo_id,a.data),class:"w-full",disabled:!a.data.articulo_id||e(k)(a.data.articulo_id)&&!v(a.data.articulo_id),onInput:d=>e(q)(a.data)},null,8,["modelValue","onUpdate:modelValue","max","disabled","onInput"]),!v(a.data.articulo_id)&&a.data.cantidad>e(V)(a.data.articulo_id,a.data)?(n(),o("small",ae," Máx: "+s(e(V)(a.data.articulo_id,a.data)),1)):b("",!0),e(k)(a.data.articulo_id)&&!v(a.data.articulo_id)?(n(),o("small",le," Solo puedes vender un equipo por fila si requiere IMEI. ")):b("",!0)]),_:1}),i(e(r),{field:"precio_unitario",header:"Precio"},{body:u(a=>[t("span",null,s(a.data.precio_unitario.toFixed(2)),1)]),_:1}),i(e(r),{field:"subtotal",header:"Subtotal"},{body:u(a=>[x(s((a.data.cantidad*a.data.precio_unitario).toFixed(2)),1)]),_:1}),i(e(r),{header:"Acciones"},{body:u(a=>[i(e(m),{icon:"pi pi-trash",class:"p-button-danger p-button-sm",onClick:d=>e(T)(a.index)},null,8,["onClick"])]),_:1}),i(e(r),{header:"IMEI"},{body:u(a=>[t("div",te,[v(a.data.articulo_id)?(n(),o("span",ie,"NA")):(n(),o(w,{key:1},[e(k)(a.data.articulo_id)?(n(),z(e(C),{key:0,modelValue:a.data.imei,"onUpdate:modelValue":d=>a.data.imei=d,options:e(R)(a.data.articulo_id,a.data),optionLabel:"imei",optionValue:"imei",placeholder:"Selecciona IMEI",class:"w-full imei-dropdown",disabled:!a.data.articulo_id},null,8,["modelValue","onUpdate:modelValue","options","disabled"])):b("",!0),a.data.imei?(n(),o("div",de,[l[10]||(l[10]=t("span",null,"IMEI seleccionado:",-1)),t("span",ne,s(a.data.imei),1)])):b("",!0)],64))])]),_:1})]),_:1},8,["value"]),i(e(m),{label:"Agregar Artículo",icon:"pi pi-plus",class:"mb-2",onClick:e(B),disabled:e(y)().length===0},null,8,["onClick","disabled"]),t("div",oe,[l[11]||(l[11]=t("label",null,"Observaciones",-1)),i(e(h),{modelValue:e(c).observaciones,"onUpdate:modelValue":l[2]||(l[2]=a=>e(c).observaciones=a),class:"w-full"},null,8,["modelValue"])]),t("div",se,[t("strong",null,"Total: $"+s(e(E).toFixed(2)),1)]),i(e(m),{label:"Guardar Venta",class:"mb-2",onClick:e(j),disabled:!e(c).cliente_id||e(c).articulos.length===0},null,8,["onClick","disabled"]),l[21]||(l[21]=t("h2",{class:"ventas-title"},"Ventas Registradas",-1)),i(e(D),{value:e(N),selectionMode:"single",selection:e(p),"onUpdate:selection":l[3]||(l[3]=a=>A(p)?p.value=a:null),onRowSelect:e(I)},{default:u(()=>[i(e(r),{field:"id",header:"ID"}),i(e(r),{field:"cliente_nombre",header:"Cliente"}),i(e(r),{field:"fecha",header:"Fecha"}),i(e(r),{field:"total",header:"Total"}),i(e(r),{header:"Acciones"},{body:u(a=>[i(e(m),{label:"Ver Detalle",icon:"pi pi-eye",class:"p-button-text",onClick:d=>{e(I)({data:a.data}),g.value=!0}},null,8,["onClick"])]),_:1})]),_:1},8,["value","selection","onRowSelect"]),i(e(U),{visible:g.value,"onUpdate:visible":l[5]||(l[5]=a=>g.value=a),header:"Detalle de Venta",modal:!0,class:"ventas-dialog"},{default:u(()=>{var a;return[e(_)&&e(_).length?(n(),o("div",ue,[t("table",re,[t("thead",null,[t("tr",null,[l[12]||(l[12]=t("th",null,"Artículo",-1)),l[13]||(l[13]=t("th",null,"Cantidad",-1)),l[14]||(l[14]=t("th",null,"Precio",-1)),l[15]||(l[15]=t("th",null,"Subtotal",-1)),e(_).some(d=>d.imei)?(n(),o("th",ce,"IMEI")):b("",!0)])]),t("tbody",null,[(n(!0),o(w,null,H(e(_),d=>(n(),o("tr",{key:d.id},[t("td",null,s(d.articulo_nombre),1),t("td",null,s(d.cantidad),1),t("td",null,"$"+s(d.precio_unitario.toFixed(2)),1),t("td",null,"$"+s((d.cantidad*d.precio_unitario).toFixed(2)),1),d.imei?(n(),o("td",ve,s(d.imei),1)):b("",!0)]))),128))])]),t("div",be,[t("div",null,[l[16]||(l[16]=t("strong",null,"Observaciones:",-1)),x(" "+s(((a=e(p))==null?void 0:a.observaciones)||"Sin observaciones"),1)]),t("div",me,[l[17]||(l[17]=t("strong",null,"Total:",-1)),x(" $"+s(e(_).reduce((d,$)=>d+$.cantidad*$.precio_unitario,0).toFixed(2)),1)])])])):(n(),o("div",_e,l[18]||(l[18]=[t("span",null,"No hay detalle disponible.",-1)]))),i(e(m),{label:"Cerrar",onClick:l[4]||(l[4]=d=>g.value=!1),class:"detalle-cerrar-btn"})]}),_:1},8,["visible"]),i(e(U),{visible:e(f),"onUpdate:visible":l[7]||(l[7]=a=>A(f)?f.value=a:null),header:"Venta registrada",closable:!1,modal:!0,class:"ventas-dialog"},{default:u(()=>[l[19]||(l[19]=t("p",null,"La nota de venta se registró correctamente.",-1)),i(e(m),{label:"Aceptar",icon:"pi pi-check",onClick:l[6]||(l[6]=a=>f.value=!1),autofocus:""})]),_:1},8,["visible"])])]))}},Ce=J(pe,[["__scopeId","data-v-d492190e"]]);export{Ce as default};
