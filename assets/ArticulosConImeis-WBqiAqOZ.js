import{_ as T,r as l,l as h,k as X,c as z,a as r,b as t,d as a,w as u,m as K,o as R,g as q,i as v,s as n,e as A,A as b,t as D,j as G}from"./index-DrPL23k6.js";import{b as H}from"./articulosService-Cnuihfk0.js";import{u as I,w as J,F as Q}from"./FileSaver.min-Bul9EBtc.js";const W={class:"articulos-con-imeis"},Y={class:"table-actions"},Z={class:"articulos-imeis-card"},P={class:"dialog-content"},ee={class:"imeis-dialog-actions"},se={__name:"ArticulosConImeis",setup(oe){const f=l([]),w=l([]),_=l(!0),y=l(!1),p=l([]),m=l(""),x=l("articulo_nombre"),k=l(1),d=l(!1),c=l(!1),g=h(()=>{const s={};return f.value.forEach(e=>{s[e.articulo_nombre]||(s[e.articulo_nombre]=[]),s[e.articulo_nombre].push(e)}),Object.entries(s).map(([e,o])=>({articulo_nombre:e,cantidad:o.length,imeis:o}))}),S=h(()=>m.value?g.value.filter(s=>{var e;return(e=s.articulo_nombre)==null?void 0:e.toLowerCase().includes(m.value.toLowerCase())}):g.value),$=h(()=>d.value?p.value.filter(s=>s.status==="Vendido"):c.value?p.value.filter(s=>s.status==="Disponible"):p.value),B=s=>{const e=g.value.find(o=>o.articulo_nombre===s);p.value=e?e.imeis:[],y.value=!0},N=s=>{x.value=s.sortField,k.value=s.sortOrder},O=async()=>{_.value=!0;try{const s=await K(),e=await fetch("https://64.227.15.111/imeis-vendidos").then(o=>o.json());f.value=[...s,...e],w.value=await H()}finally{_.value=!1}},L=()=>{const s={};f.value.forEach(i=>{s[i.articulo_nombre]||(s[i.articulo_nombre]=[]),s[i.articulo_nombre].push(i)});const e=new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}),o=w.value.map(i=>{var F;const E=((F=s[i.nombre])==null?void 0:F.length)||0,M=Number(i.precioVenta)||0;return{Artículo:i.nombre,SKU:i.sku,Tipo:i.tipo,Unidad:i.unidad,"Precio unitario":e.format(M),"Cantidad en stock":E,"Total inventario":e.format(M*E),Descripción:i.descripcion,Impuesto:i.impuesto}}),C=I.json_to_sheet(o),V=I.book_new();I.book_append_sheet(V,C,"Inventario");const U=J(V,{bookType:"xlsx",type:"array"});Q.saveAs(new Blob([U],{type:"application/octet-stream"}),"inventario.xlsx")},j=s=>s.status==="Vendido"?"imei-vendido":s.status==="Disponible"?"imei-disponible":"";return X(O),(s,e)=>(R(),z("div",W,[e[4]||(e[4]=r("h2",null,"Stock por Artículo",-1)),r("div",Y,[t(a(q),{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=o=>m.value=o),placeholder:"Filtrar por artículo...",class:"p-inputtext-sm",style:{"max-width":"250px"}},null,8,["modelValue"]),t(a(v),{icon:"pi pi-file-excel",class:"p-button-success p-button-sm",label:"Exportar Excel",style:{"margin-left":"1rem"},onClick:L})]),r("div",Z,[t(a(A),{value:S.value,sortField:x.value,sortOrder:k.value,responsiveLayout:"scroll",onSort:N,loading:_.value},{default:u(()=>[t(a(n),{field:"articulo_nombre",header:"Artículo",sortable:""}),t(a(n),{field:"cantidad",header:"Cantidad IMEIs",sortable:""}),t(a(n),{header:"Ver IMEIs"},{body:u(o=>[t(a(v),{label:"Ver IMEIs",onClick:C=>B(o.data.articulo_nombre)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),t(a(G),{visible:y.value,"onUpdate:visible":e[3]||(e[3]=o=>y.value=o),header:"IMEIs Asociados",modal:!0,closable:!0},{default:u(()=>[r("div",P,[r("div",ee,[t(a(v),{label:"Mostrar solo vendidos",icon:d.value?"pi pi-eye-slash":"pi pi-eye",class:b(["p-button-sm",d.value?"p-button-danger":"p-button-secondary"]),onClick:e[1]||(e[1]=o=>d.value=!d.value),style:{"margin-bottom":"1rem"}},null,8,["icon","class"]),t(a(v),{label:"Mostrar solo disponibles",icon:c.value?"pi pi-eye-slash":"pi pi-eye",class:b(["p-button-sm",c.value?"p-button-info":"p-button-secondary"]),onClick:e[2]||(e[2]=o=>c.value=!c.value),style:{"margin-bottom":"1rem","margin-left":"0.5rem"}},null,8,["icon","class"])]),t(a(A),{value:$.value,responsiveLayout:"scroll",rowClass:j},{default:u(()=>[t(a(n),{field:"imei",header:"IMEI"}),t(a(n),{field:"status",header:"Estado"},{body:u(o=>[r("span",{class:b({"vendido-label":o.data.status==="Vendido","disponible-label":o.data.status==="Disponible"})},D(o.data.status),3)]),_:1}),t(a(n),{field:"registeredBy",header:"Registró"}),t(a(n),{field:"date",header:"Fecha"}),t(a(n),{header:"Origen"},{body:u(o=>[r("span",{class:b({"origen-vendido":o.data.status==="Vendido","origen-disponible":o.data.status==="Disponible"})},D(o.data.status==="Vendido"?"Lista Vendidos":"Disponible"),3)]),_:1})]),_:1},8,["value"])])]),_:1},8,["visible"])]))}},le=T(se,[["__scopeId","data-v-32d9117b"]]);export{le as default};
