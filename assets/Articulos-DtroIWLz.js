import{g as j,u as q,a as z,d as G}from"./articulosService-CMYE2WoL.js";import{_ as H,r,k as J,l as $,c as w,a as o,b as s,d as t,w as n,m as Q,o as C,i as u,g as b,s as m,n as h,t as g,e as R,p as _,q as M,j as y}from"./index-D76T6ImS.js";import"./FileSaver.min-BCxzAtLx.js";const W={class:"articulos"},Y={class:"actions"},Z={class:"articulos-card"},ee={class:"modal-content"},le={class:"modal-title"},oe={class:"form-grid"},ae={class:"form-col"},se={class:"form-group"},te={class:"form-group"},ie={key:0,class:"error-text"},re={class:"form-group"},ue={key:0,class:"error-text"},ne={class:"form-group"},de={class:"form-col"},ce={class:"form-group"},pe={class:"form-group"},ve={class:"form-group"},me={class:"modal-actions"},fe={class:"dialog-content"},be={class:"modal-actions"},Ve={class:"dialog-content"},ge={class:"modal-actions"},ke={__name:"Articulos",setup(Ae){const U=r([]),E=r([]),k=r(!0),d=r(!1),a=r({id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""}),c=r(""),D=r("nombre"),S=r(1),p=r(!1),V=r(""),f=r(!1),N=r(null),A=async()=>{k.value=!0;try{U.value=await j(),E.value=await Q()}finally{k.value=!1}};J(A);const x=$(()=>{const i={};return E.value.forEach(e=>{i[e.articulo_nombre]||(i[e.articulo_nombre]=[]),i[e.articulo_nombre].push(e)}),U.value.map(e=>{const v=(i[e.nombre]||[]).filter(X=>X.status==="Disponible").length;return Number(e.precioVenta),{...e,existencias:v}})}),I=i=>new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(Number(i)||0),L=$(()=>c.value?x.value.filter(i=>{var e,l,v;return((e=i.nombre)==null?void 0:e.toLowerCase().includes(c.value.toLowerCase()))||((l=i.sku)==null?void 0:l.toLowerCase().includes(c.value.toLowerCase()))||((v=i.descripcion)==null?void 0:v.toLowerCase().includes(c.value.toLowerCase()))}):x.value),B=()=>{a.value={id:null,sku:"",nombre:"",descripcion:"",tipo:"",precioVenta:"",unidad:"",impuesto:""},d.value=!0},O=()=>{d.value=!1},T=async()=>{if(!a.value.nombre||!a.value.sku){V.value="Por favor, complete los campos obligatorios.",p.value=!0;return}try{const i={...a.value,codigo:a.value.codigo??"",pagina:a.value.pagina??""};a.value.id?await q(i):await z(i),d.value=!1,await A()}catch{V.value="Error al guardar el artículo.",p.value=!0}},F=i=>{a.value={...i},d.value=!0},P=i=>{N.value=i,f.value=!0},K=async i=>{try{await G(i),await A(),f.value=!1}catch{V.value="Error al eliminar el artículo.",p.value=!0}};return(i,e)=>(C(),w("div",W,[e[22]||(e[22]=o("h2",null,"Artículos",-1)),o("div",Y,[s(t(u),{label:"Agregar Artículo",icon:"pi pi-plus",onClick:B}),s(t(b),{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=l=>c.value=l),placeholder:"Buscar...",class:"ml-2"},null,8,["modelValue"])]),o("div",Z,[s(t(R),{value:L.value,sortField:D.value,sortOrder:S.value,responsiveLayout:"scroll",loading:k.value},{default:n(()=>[s(t(m),{field:"sku",header:"SKU",sortable:""}),s(t(m),{field:"nombre",header:"Nombre",sortable:""}),s(t(m),{field:"tipo",header:"Tipo",sortable:""}),s(t(m),{field:"precioVenta",header:"Precio de venta"},{body:n(l=>[h(g(I(l.data.precioVenta)),1)]),_:1}),s(t(m),{header:"Existencias en mano"},{body:n(l=>[h(g(l.data.existencias),1)]),_:1}),s(t(m),{header:"Acciones"},{body:n(l=>[s(t(u),{icon:"pi pi-pencil",class:"p-button-text",onClick:v=>F(l.data)},null,8,["onClick"]),s(t(u),{icon:"pi pi-trash",class:"p-button-text p-button-danger",onClick:v=>P(l.data.id)},null,8,["onClick"])]),_:1})]),_:1},8,["value","sortField","sortOrder","loading"])]),s(t(y),{visible:d.value,"onUpdate:visible":e[8]||(e[8]=l=>d.value=l),header:a.value.id?"Editar Artículo":"Nuevo Artículo",modal:!0,closable:!0,class:"custom-modal"},{default:n(()=>[o("div",ee,[o("h3",le,g(a.value.id?"Editar Artículo":"Nuevo Artículo"),1),o("div",oe,[o("div",ae,[o("div",se,[e[14]||(e[14]=o("label",{for:"tipo"},"Tipo:",-1)),s(t(_),{id:"tipo",modelValue:a.value.tipo,"onUpdate:modelValue":e[1]||(e[1]=l=>a.value.tipo=l),options:["Bienes","Servicio"],placeholder:"Selecciona tipo",class:"w-full"},null,8,["modelValue"])]),o("div",te,[e[15]||(e[15]=o("label",{for:"nombre"},"Nombre:",-1)),s(t(b),{id:"nombre",modelValue:a.value.nombre,"onUpdate:modelValue":e[2]||(e[2]=l=>a.value.nombre=l),placeholder:"Nombre del artículo",class:"w-full"},null,8,["modelValue"]),a.value.nombre?M("",!0):(C(),w("small",ie,"Obligatorio."))]),o("div",re,[e[16]||(e[16]=o("label",{for:"sku"},"SKU:",-1)),s(t(b),{id:"sku",modelValue:a.value.sku,"onUpdate:modelValue":e[3]||(e[3]=l=>a.value.sku=l),placeholder:"SKU o código interno",class:"w-full"},null,8,["modelValue"]),a.value.sku?M("",!0):(C(),w("small",ue,"Obligatorio."))]),o("div",ne,[e[17]||(e[17]=o("label",{for:"unidad"},"Unidad:",-1)),s(t(_),{id:"unidad",modelValue:a.value.unidad,"onUpdate:modelValue":e[4]||(e[4]=l=>a.value.unidad=l),options:["pieza","servicio","kg","litro"],placeholder:"Selecciona unidad",class:"w-full"},null,8,["modelValue"])])]),o("div",de,[o("div",ce,[e[18]||(e[18]=o("label",{for:"precioVenta"},"Precio de venta (MXN):",-1)),s(t(b),{id:"precioVenta",modelValue:a.value.precioVenta,"onUpdate:modelValue":e[5]||(e[5]=l=>a.value.precioVenta=l),placeholder:"Precio de venta",class:"w-full"},null,8,["modelValue"])]),o("div",pe,[e[19]||(e[19]=o("label",{for:"impuesto"},"Impuesto:",-1)),s(t(_),{id:"impuesto",modelValue:a.value.impuesto,"onUpdate:modelValue":e[6]||(e[6]=l=>a.value.impuesto=l),options:["IVA 16%","IVA 0%","Exento"],placeholder:"Selecciona impuesto",class:"w-full"},null,8,["modelValue"])]),o("div",ve,[e[20]||(e[20]=o("label",{for:"descripcion"},"Descripción:",-1)),s(t(b),{id:"descripcion",modelValue:a.value.descripcion,"onUpdate:modelValue":e[7]||(e[7]=l=>a.value.descripcion=l),placeholder:"Descripción (opcional)",class:"w-full"},null,8,["modelValue"])])])]),o("div",me,[s(t(u),{label:"Guardar",icon:"pi pi-save",onClick:T}),s(t(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:O})])])]),_:1},8,["visible","header"]),s(t(y),{visible:p.value,"onUpdate:visible":e[10]||(e[10]=l=>p.value=l),header:"Error",modal:!0,closable:!1},{default:n(()=>[o("div",fe,[o("p",null,g(V.value),1),o("div",be,[s(t(u),{label:"Aceptar",icon:"pi pi-check",onClick:e[9]||(e[9]=l=>p.value=!1)})])])]),_:1},8,["visible"]),s(t(y),{visible:f.value,"onUpdate:visible":e[13]||(e[13]=l=>f.value=l),header:"Confirmar Eliminación",modal:!0,closable:!1},{default:n(()=>[o("div",Ve,[e[21]||(e[21]=o("p",null,"¿Eliminar este artículo?",-1)),o("div",ge,[s(t(u),{label:"Eliminar",icon:"pi pi-trash",class:"p-button-danger",onClick:e[11]||(e[11]=l=>K(N.value))}),s(t(u),{label:"Cancelar",icon:"pi pi-times",class:"p-button-secondary",onClick:e[12]||(e[12]=l=>f.value=!1)})])])]),_:1},8,["visible"])]))}},ye=H(ke,[["__scopeId","data-v-974280b5"]]);export{ye as default};
